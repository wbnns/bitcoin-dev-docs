
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>P2P Network &#8212; Bitcoin for Developers  documentation</title>

    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-4.3.1-dist/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinxbootstrap4.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/sphinxbootstrap4.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RPC API Reference" href="rpc/index.html" />
    <link rel="prev" title="Wallets" href="wallets.html" /> 
  </head><body>
  <nav class="navbar navbar-expand-md  fixed-top navbar-dark bg-dark flex-wrap">
    <button class="navbar-toggler ml-auto py-2" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2">
      &#9776;
    </button>
      <div class="navbar-collapse collapse" id="exCollapsingNavbar2">
           <a class="navbar-brand py-1" href="../index.html">
                  Bitcoin for Developers
          </a>
          <ul class="navbar-nav mr-auto">
          
          </ul>
          <div class="dropdown-divider d-block d-sm-none mb-4"></div>
             
<form class="form-inline" action="../search.html" method="get">
  <input type="text" name="q" class="form-control" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <!--<div class="row hidden-sm-up">
          <div class="collapse navbar-toggleable-xs container" id="exCollapsingNavbar2">
              <div class="container">
             　　 <a class="navbar-brand" href="../index.html">
                      Bitcoin for Developers
                  </a>
              </div>
              <ul class="nav navbar-nav">
              </ul>
              <div class="dropdown-divider"></div>
              <div class="navbar-text">search<div>
              
<form class="form-inline" action="../search.html" method="get">
  <input type="text" name="q" class="form-control" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          </div>
      </div>-->
    </nav>
  </div>

    <div class="related d-flex justify-content-between bg-light flex-wrap" role="navigation" aria-label="related navigation">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="../index.html">Bitcoin for Developers  documentation</a></li>
                <li class="breadcrumb-item"><a href="index.html"
                       
                         accesskey="U"
                         class="active"
                       >Reference</a></li>
            <li class="breadcrumb-item active">P2P Network</li>
        </ol>
       <div>
          <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
               <a href="wallets.html" title="Previous Chapter: Wallets" class="btn btn-primary" role="botton" accesskey="P">
                   &laquo; Wallets
               </a>
               <a href="rpc/index.html" title="Next Chapter: RPC API Reference" class="btn btn-primary" role="botton" accesskey="N">
                   RPC API Reference &raquo;
               </a>
           </div>
       </div>
    </div>

  <div class="main container-fluid">
    <div class="row"> 
      <div class="sphinxsidebar d-none d-md-block">
        <div class="sphinxsidebarwrapper">          
            <h4>Table Of Contents</h4>
            
            
              <div class="sidebartoctree">
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../devguide/index.html">Developer Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../devguide/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/block_chain.html">Block Chain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#block-chain-overview">Block Chain Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#proof-of-work">Proof Of Work</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#block-height-and-forking">Block Height And Forking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#transaction-data">Transaction Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#consensus-rule-changes">Consensus Rule Changes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/block_chain.html#detecting-forks">Detecting Forks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/transactions.html">Transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#p2pkh-script-validation">P2PKH Script Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#p2sh-scripts">P2SH Scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#standard-transactions">Standard Transactions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#pay-to-public-key-hash-p2pkh">Pay To Public Key Hash (P2PKH)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#pay-to-script-hash-p2sh">Pay To Script Hash (P2SH)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#multisig">Multisig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#pubkey">Pubkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#null-data">Null Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#non-standard-transactions">Non-Standard Transactions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#signature-hash-types">Signature Hash Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#locktime-and-sequence-number">Locktime And Sequence Number</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#transaction-fees-and-change">Transaction Fees And Change</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#avoiding-key-reuse">Avoiding Key Reuse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#transaction-malleability">Transaction Malleability</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/contracts.html">Contracts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/contracts.html#escrow-and-arbitration">Escrow And Arbitration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/contracts.html#micropayment-channel">Micropayment Channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/contracts.html#coinjoin">CoinJoin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/wallets.html">Wallets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/wallets.html#wallet-programs">Wallet Programs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#full-service-wallets">Full-Service Wallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#signing-only-wallets">Signing-Only Wallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#distributing-only-wallets">Distributing-Only Wallets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/wallets.html#wallet-files">Wallet Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#private-key-formats">Private Key Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#public-key-formats">Public Key Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#hierarchical-deterministic-key-creation">Hierarchical Deterministic Key Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#loose-key-wallets">Loose-Key Wallets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/payment_processing.html">Payment Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#pricing-orders">Pricing Orders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#requesting-payments">Requesting Payments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#plain-text">Plain Text</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#bitcoin-uri">bitcoin: URI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#qr-codes">QR Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#payment-protocol">Payment Protocol</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#verifying-payment">Verifying Payment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#issuing-refunds">Issuing Refunds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#disbursing-income-limiting-forex-risk">Disbursing Income (Limiting Forex Risk)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#merge-avoidance">Merge Avoidance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#last-in-first-out-lifo">Last In, First Out (LIFO)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#first-in-first-out-fifo">First In, First Out (FIFO)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#rebilling-recurring-payments">Rebilling Recurring Payments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/operating_modes.html">Operating Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/operating_modes.html#full-node">Full Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/operating_modes.html#simplified-payment-verification-spv">Simplified Payment Verification (SPV)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/operating_modes.html#potential-spv-weaknesses">Potential SPV Weaknesses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/operating_modes.html#bloom-filters">Bloom Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/operating_modes.html#application-of-bloom-filters">Application Of Bloom Filters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/operating_modes.html#future-proposals">Future Proposals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/p2p_network.html">P2P Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#peer-discovery">Peer Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#connecting-to-peers">Connecting To Peers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#initial-block-download">Initial Block Download</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/p2p_network.html#blocks-first">Blocks-First</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/p2p_network.html#headers-first">Headers-First</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#block-broadcasting">Block Broadcasting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/p2p_network.html#orphan-blocks">Orphan Blocks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#transaction-broadcasting">Transaction Broadcasting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/p2p_network.html#memory-pool">Memory Pool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#misbehaving-nodes">Misbehaving Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#alerts">Alerts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/mining.html">Mining</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/mining.html#solo-mining">Solo Mining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/mining.html#pool-mining">Pool Mining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/mining.html#block-prototypes">Block Prototypes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/mining.html#getwork-rpc">getwork RPC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/mining.html#getblocktemplate-rpc">getblocktemplate RPC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/mining.html#stratum">Stratum</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="intro.html#not-a-specification">Not A Specification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="block_chain.html">Block Chain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="block_chain.html#block-headers">Block Headers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="block_chain.html#block-versions">Block Versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="block_chain.html#merkle-trees">Merkle Trees</a></li>
<li class="toctree-l4"><a class="reference internal" href="block_chain.html#target-nbits">Target nBits</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="block_chain.html#serialized-blocks">Serialized Blocks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">Transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="transactions.html#opcodes">OpCodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="transactions.html#address-conversion">Address Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="transactions.html#raw-transaction-format">Raw Transaction Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#txin-a-transaction-input-non-coinbase">TxIn: A Transaction Input (Non-Coinbase)</a></li>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#outpoint-the-specific-part-of-a-specific-output">Outpoint: The Specific Part Of A Specific Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#txout-a-transaction-output">TxOut: A Transaction Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#coinbase-input-the-input-of-the-first-transaction-in-a-block">Coinbase Input: The Input Of The First Transaction In A Block</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="wallets.html">Wallets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="wallets.html#deterministic-wallet-formats">Deterministic Wallet Formats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wallets.html#type-1-single-chain-wallets">Type 1: Single Chain Wallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="wallets.html#type-2-hierarchical-deterministic-hd-wallets">Type 2: Hierarchical Deterministic (HD) Wallets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">P2P Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#constants-and-defaults">Constants And Defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="#protocol-versions">Protocol Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#message-headers">Message Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-messages">Data Messages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#block">Block</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getblocks">GetBlocks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getdata">GetData</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getheaders">GetHeaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="#headers">Headers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inv">Inv</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mempool">MemPool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#merkleblock">MerkleBlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cmpctblock">CmpctBlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sendcmpct">SendCmpct</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getblocktxn">GetBlockTxn</a></li>
<li class="toctree-l4"><a class="reference internal" href="#blocktxn">BlockTxn</a></li>
<li class="toctree-l4"><a class="reference internal" href="#notfound">NotFound</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tx">Tx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#control-messages">Control Messages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#addr">Addr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alert">Alert</a></li>
<li class="toctree-l4"><a class="reference internal" href="#feefilter">FeeFilter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filteradd">FilterAdd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filterclear">FilterClear</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filterload">FilterLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getaddr">GetAddr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ping">Ping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pong">Pong</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reject">Reject</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sendheaders">SendHeaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="#verack">VerAck</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version">Version</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rpc/index.html">RPC API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rpc/index.html#blockchain-rpcs">Blockchain RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rpc/getbestblockhash.html">getbestblockhash</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getblock.html">getblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getblockchaininfo.html">getblockchaininfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getblockcount.html">getblockcount</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getblockhash.html">getblockhash</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getblockheader.html">getblockheader</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getblockstats.html">getblockstats</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getchaintips.html">getchaintips</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getchaintxstats.html">getchaintxstats</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getdifficulty.html">getdifficulty</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getmempoolancestors.html">getmempoolancestors</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getmempooldescendants.html">getmempooldescendants</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getmempoolentry.html">getmempoolentry</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getmempoolinfo.html">getmempoolinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getrawmempool.html">getrawmempool</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/gettxout.html">gettxout</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/gettxoutproof.html">gettxoutproof</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/gettxoutsetinfo.html">gettxoutsetinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/preciousblock.html">preciousblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/pruneblockchain.html">pruneblockchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/savemempool.html">savemempool</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/scantxoutset.html">scantxoutset</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/verifychain.html">verifychain</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/verifytxoutproof.html">verifytxoutproof</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rpc/index.html#control-rpcs">Control RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rpc/getmemoryinfo.html">getmemoryinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getrpcinfo.html">getrpcinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/help.html">help</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/logging.html">logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/stop.html">stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/uptime.html">uptime</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rpc/index.html#generating-rpcs">Generating RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rpc/generate.html">generate</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/generatetoaddress.html">generatetoaddress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rpc/index.html#mining-rpcs">Mining RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rpc/getblocktemplate.html">getblocktemplate</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getmininginfo.html">getmininginfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getnetworkhashps.html">getnetworkhashps</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/prioritisetransaction.html">prioritisetransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/submitblock.html">submitblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/submitheader.html">submitheader</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rpc/index.html#network-rpcs">Network RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rpc/addnode.html">addnode</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/clearbanned.html">clearbanned</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/disconnectnode.html">disconnectnode</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getaddednodeinfo.html">getaddednodeinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getconnectioncount.html">getconnectioncount</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getnettotals.html">getnettotals</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getnetworkinfo.html">getnetworkinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getnodeaddresses.html">getnodeaddresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getpeerinfo.html">getpeerinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listbanned.html">listbanned</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/ping.html">ping</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/setban.html">setban</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/setnetworkactive.html">setnetworkactive</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rpc/index.html#rawtransactions-rpcs">Rawtransactions RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rpc/analyzepsbt.html">analyzepsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/combinepsbt.html">combinepsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/combinerawtransaction.html">combinerawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/converttopsbt.html">converttopsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/createpsbt.html">createpsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/createrawtransaction.html">createrawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/decodepsbt.html">decodepsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/decoderawtransaction.html">decoderawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/decodescript.html">decodescript</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/finalizepsbt.html">finalizepsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/fundrawtransaction.html">fundrawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getrawtransaction.html">getrawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/joinpsbts.html">joinpsbts</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/sendrawtransaction.html">sendrawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/signrawtransactionwithkey.html">signrawtransactionwithkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/testmempoolaccept.html">testmempoolaccept</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/utxoupdatepsbt.html">utxoupdatepsbt</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rpc/index.html#util-rpcs">Util RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rpc/createmultisig.html">createmultisig</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/deriveaddresses.html">deriveaddresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/estimatesmartfee.html">estimatesmartfee</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getdescriptorinfo.html">getdescriptorinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/signmessagewithprivkey.html">signmessagewithprivkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/validateaddress.html">validateaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/verifymessage.html">verifymessage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rpc/index.html#wallet-rpcs">Wallet RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rpc/abandontransaction.html">abandontransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/abortrescan.html">abortrescan</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/addmultisigaddress.html">addmultisigaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/backupwallet.html">backupwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/bumpfee.html">bumpfee</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/createwallet.html">createwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/dumpprivkey.html">dumpprivkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/dumpwallet.html">dumpwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/encryptwallet.html">encryptwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getaddressesbylabel.html">getaddressesbylabel</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getaddressinfo.html">getaddressinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getbalance.html">getbalance</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getnewaddress.html">getnewaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getrawchangeaddress.html">getrawchangeaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getreceivedbyaddress.html">getreceivedbyaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getreceivedbylabel.html">getreceivedbylabel</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/gettransaction.html">gettransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getunconfirmedbalance.html">getunconfirmedbalance</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/getwalletinfo.html">getwalletinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/importaddress.html">importaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/importmulti.html">importmulti</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/importprivkey.html">importprivkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/importprunedfunds.html">importprunedfunds</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/importpubkey.html">importpubkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/importwallet.html">importwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/keypoolrefill.html">keypoolrefill</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listaddressgroupings.html">listaddressgroupings</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listlabels.html">listlabels</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listlockunspent.html">listlockunspent</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listreceivedbyaddress.html">listreceivedbyaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listreceivedbylabel.html">listreceivedbylabel</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listsinceblock.html">listsinceblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listtransactions.html">listtransactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listunspent.html">listunspent</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listwalletdir.html">listwalletdir</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/listwallets.html">listwallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/loadwallet.html">loadwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/lockunspent.html">lockunspent</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/removeprunedfunds.html">removeprunedfunds</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/rescanblockchain.html">rescanblockchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/sendmany.html">sendmany</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/sendtoaddress.html">sendtoaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/sethdseed.html">sethdseed</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/setlabel.html">setlabel</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/settxfee.html">settxfee</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/signmessage.html">signmessage</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/signrawtransactionwithwallet.html">signrawtransactionwithwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/unloadwallet.html">unloadwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/walletcreatefundedpsbt.html">walletcreatefundedpsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/walletlock.html">walletlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/walletpassphrase.html">walletpassphrase</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/walletpassphrasechange.html">walletpassphrasechange</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpc/walletprocesspsbt.html">walletprocesspsbt</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/testing.html">Testing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/testing.html#testnet">Testnet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/testing.html#regtest-mode">Regtest Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/transactions.html">Transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/transactions.html#transaction-tutorial">Transaction Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../examples/transactions.html#simple-spending">Simple Spending</a></li>
<li class="toctree-l4"><a class="reference internal" href="../examples/transactions.html#simple-raw-transaction">Simple Raw Transaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../examples/transactions.html#complex-raw-transaction">Complex Raw Transaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../examples/transactions.html#offline-signing">Offline Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../examples/transactions.html#p2sh-multisig">P2SH Multisig</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/payment_processing.html">Payment Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/payment_processing.html#payment-protocol">Payment Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../examples/payment_processing.html#paymentrequest-paymentdetails">PaymentRequest &amp; PaymentDetails</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/p2p_networking.html">P2P Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/p2p_networking.html#creating-a-bloom-filter">Creating A Bloom Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/p2p_networking.html#evaluating-a-bloom-filter">Evaluating A Bloom Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/p2p_networking.html#retrieving-a-merkleblock">Retrieving A MerkleBlock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/p2p_networking.html#parsing-a-merkleblock">Parsing A MerkleBlock</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

              </div>
            
          
  <h4>Previous topic</h4>
  <p class="topless"><a href="wallets.html"
                        title="previous chapter">Wallets</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rpc/index.html"
                        title="next chapter">RPC API Reference</a></p>
<div id="searchbox" style="display: none">
    <form class="form search" action="../search.html" method="get">
      <input type="text" name="q" class="form-control" placeholder="Search..." />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>

<script type="text/javascript">$('#searchbox').show(0);</script>
  <ul class="this-page-menu list-unstyled text-right">
    <li><a href="../_sources/reference/p2p_networking.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div> 

      <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="p2p-network">
<h1>P2P Network<a class="headerlink" href="#p2p-network" title="Permalink to this headline">¶</a></h1>
<p>This section describes the Bitcoin P2P <a class="reference external" href="/en/developer-guide#term-network">network</a> protocol (but it is <a class="reference external" href="/en/developer-reference#not-a-specification">not a specification</a>). It does not describe the discontinued direct <a class="reference external" href="https://en.bitcoin.it/wiki/IP_Transactions">IP-to-IP payment protocol</a>, the <a class="reference external" href="../reference/glossary.html#payment-protocol">BIP70 payment protocol</a>, the <a class="reference external" href="/en/developer-guide#getblocktemplate-rpc">GetBlockTemplate mining protocol</a>, or any <a class="reference external" href="/en/developer-guide#term-network">network</a> protocol never implemented in an official version of Bitcoin Core.</p>
<p>All <a class="reference external" href="/en/developer-guide#term-network">peer-to-peer</a> communication occurs entirely over TCP.</p>
<p><strong>Note:</strong> unless their description says otherwise, all multi-byte integers mentioned in this section are transmitted in little-endian order.</p>
<div class="section" id="constants-and-defaults">
<h2>Constants And Defaults<a class="headerlink" href="#constants-and-defaults" title="Permalink to this headline">¶</a></h2>
<p>The following constants and defaults are taken from Bitcoin Core’s <a class="reference external" href="https://github.com/bitcoin/bitcoin/blob/master/src/chainparams.cpp">chainparams.cpp</a> source code file.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 36%" />
<col style="width: 10%" />
<col style="width: 45%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><a class="reference external" href="/en/developer-guide#term-network">Network</a></p></th>
<th class="head"><p>Default Port</p></th>
<th class="head"><p><a class="reference external" href="../reference/glossary.html#start-string">Start String</a></p></th>
<th class="head"><p>Max nBits</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Mainnet</p></td>
<td><p>8333</p></td>
<td><p>0xf9beb4d9</p></td>
<td><p>0x1d00ffff</p></td>
</tr>
<tr class="row-odd"><td><p>Testnet</p></td>
<td><p>18333</p></td>
<td><p>0x0b110907</p></td>
<td><p>0x1d00ffff</p></td>
</tr>
<tr class="row-even"><td><p>Regtest</p></td>
<td><p>18444</p></td>
<td><p>0xfabfb5da</p></td>
<td><p>0x207fffff</p></td>
</tr>
</tbody>
</table>
<p>Note: the testnet start string and nBits above are for testnet3; the original testnet used a different string and higher (less difficult) nBits.</p>
<p>Command line parameters can change what port a node listens on (see <code class="docutils literal notranslate"><span class="pre">-help</span></code>). Start strings are hardcoded constants that appear at the start of all messages sent on the Bitcoin <a class="reference external" href="/en/developer-guide#term-network">network</a>; they may also appear in data files such as Bitcoin Core’s block database. The nBits displayed above are in big-endian order; they’re sent over the <a class="reference external" href="/en/developer-guide#term-network">network</a> in little-endian order.</p>
<p>Bitcoin Core’s <a class="reference external" href="https://github.com/bitcoin/bitcoin/blob/master/src/chainparams.cpp">chainparams.cpp</a> also includes other constants useful to programs, such as the hash of the genesis blocks for the different networks.</p>
</div>
<div class="section" id="protocol-versions">
<h2>Protocol Versions<a class="headerlink" href="#protocol-versions" title="Permalink to this headline">¶</a></h2>
<p>The table below lists some notable versions of the P2P <a class="reference external" href="/en/developer-guide#term-network">network</a> protocol, with the most recent versions listed first. (If you know of a protocol version that implemented a major change but which is not listed here, please <a class="reference external" href="https://github.com/bitcoin-dot-org/bitcoin.org/issues">open an issue</a>.)</p>
<p>As of <a class="reference external" href="/en/release/v0.14.2">Bitcoin Core 0.14.2</a>, the most recent protocol version is 70015.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 1%" />
<col style="width: 15%" />
<col style="width: 84%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Initial Release</p></th>
<th class="head"><p>Major Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>70015</p></td>
<td><p><a class="reference external" href="/en/release/v0.13.2">Bitcoin Core 0.13.2</a> (Jan 2017)</p></td>
<td><ul class="simple">
<li><p>New banning behavior for invalid compact blocks <a class="reference external" href="https://github.com/bitcoin/bitcoin/pull/9026">#9026</a> in v0.14.0, Backported to v0.13.2 in <a class="reference external" href="https://github.com/bitcoin/bitcoin/pull/9048">#9048</a>.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>70014</p></td>
<td><p><a class="reference external" href="/en/release/v0.13.0">Bitcoin Core 0.13.0</a> (Aug 2016)</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP152</a>: • Added <code class="docutils literal notranslate"><span class="pre">sendcmpct</span></code>, <code class="docutils literal notranslate"><span class="pre">cmpctblock</span></code>, <code class="docutils literal notranslate"><span class="pre">getblocktxn</span></code>, <a class="reference external" href="/en/developer-reference#blocktxn">“blocktxn” messages</a> • Added <a class="reference external" href="/en/developer-reference#term-msg_cmpct_block">“MSG_CMPCT_BLOCK”</a> inventory type to <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a>.</p></td>
</tr>
<tr class="row-even"><td><p>70013</p></td>
<td><p><a class="reference external" href="/en/release/v0.13.0">Bitcoin Core 0.13.0</a> (Aug 2016)</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0133.mediawiki">BIP133</a>: • Added <a class="reference external" href="/en/developer-reference#feefilter">“feefilter” message</a>. • Removed <a class="reference external" href="/en/developer-reference#alert">“alert” message</a> system. See <a class="reference external" href="https://bitcoin.org/en/alert/2016-11-01-alert-retirement">Alert System Retirement</a></p></td>
</tr>
<tr class="row-odd"><td><p>70012</p></td>
<td><p><a class="reference external" href="/en/release/v0.12.0">Bitcoin Core 0.12.0</a> (Feb 2016)</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0130.mediawiki">BIP130</a>: • Added <a class="reference external" href="/en/developer-reference#sendheaders">“sendheaders” message</a>.</p></td>
</tr>
<tr class="row-even"><td><p>70011</p></td>
<td><p><a class="reference external" href="/en/release/v0.12.0">Bitcoin Core 0.12.0</a> (Feb 2016)</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki">BIP111</a>: • <code class="docutils literal notranslate"><span class="pre">filter*</span></code> messages are disabled without NODE_BLOOM after and including this version.</p></td>
</tr>
<tr class="row-odd"><td><p>70002</p></td>
<td><p><a class="reference external" href="/en/release/v0.9.0">Bitcoin Core 0.9.0</a> (Mar 2014)</p></td>
<td><ul class="simple">
<li><p>Send multiple <a class="reference external" href="/en/developer-reference#inv">“inv” messages</a> in response to a <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a> if necessary <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki">BIP61</a>: • Added <a class="reference external" href="/en/developer-reference#reject">“reject” message</a></p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>70001</p></td>
<td><p><a class="reference external" href="/en/release/v0.8.0">Bitcoin Core 0.8.0</a> (Feb 2013)</p></td>
<td><ul class="simple">
<li><p>Added <a class="reference external" href="/en/developer-reference#notfound">“notfound” message</a>. <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a>: • Added <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a>. • Added <a class="reference external" href="/en/developer-reference#filteradd">“filteradd” message</a>. • Added <a class="reference external" href="/en/developer-reference#filterclear">“filterclear” message</a>. • Added <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a>. • Added relay field to <a class="reference external" href="/en/developer-reference#version">“version” message</a> • Added <a class="reference external" href="/en/developer-reference#term-msg_block">“MSG_FILTERED_BLOCK”</a> inventory type to <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a>.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>60002</p></td>
<td><p><a class="reference external" href="/en/release/v0.7.0">Bitcoin Core 0.7.0</a> (Sep 2012)</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0035.mediawiki">BIP35</a>: • Added <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a>. • Extended <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> to allow download of memory pool transactions</p></td>
</tr>
<tr class="row-even"><td><p>60001</p></td>
<td><p><a class="reference external" href="/en/release/v0.6.1">Bitcoin Core 0.6.1</a> (May 2012)</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki">BIP31</a>: • Added nonce field to <a class="reference external" href="/en/developer-reference#ping">“ping” message</a> • Added <a class="reference external" href="/en/developer-reference#pong">“pong” message</a></p></td>
</tr>
<tr class="row-odd"><td><p>60000</p></td>
<td><p><a class="reference external" href="/en/release/v0.6.0">Bitcoin Core 0.6.0</a> (Mar 2012)</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0014.mediawiki">BIP14</a>: • Separated protocol version from Bitcoin Core version</p></td>
</tr>
<tr class="row-even"><td><p>31800</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bitcoin/commit/82201801336f64ee77851b9eaab9383ee4e442f0">Bitcoin Core 0.3.18</a> (Dec 2010)</p></td>
<td><ul class="simple">
<li><p>Added <a class="reference external" href="/en/developer-reference#getheaders">“getheaders” message</a> and <a class="reference external" href="/en/developer-reference#headers">“headers” message</a>.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>31402</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bitcoin/commit/c891967b6fcab2e8dc4ce0c787312b36c07efa4d">Bitcoin Core 0.3.15</a> (Oct 2010)</p></td>
<td><ul class="simple">
<li><p>Added time field to <a class="reference external" href="/en/developer-reference#addr">“addr” message</a>.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>311</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bitcoin/commit/343328c6b8db85e58a1feea85f0d10e62967fa19">Bitcoin Core 0.3.11</a> (Aug 2010)</p></td>
<td><ul class="simple">
<li><p>Added <a class="reference external" href="/en/developer-reference#alert">“alert” message</a>.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>209</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bitcoin/commit/42605ce8bcc9bd01b86491c74fee14de77960868">Bitcoin Core 0.2.9</a> (May 2010)</p></td>
<td><ul class="simple">
<li><p>Added checksum field to message headers, added <a class="reference external" href="/en/developer-reference#verack">“verack” message</a>, and added starting height field to <a class="reference external" href="/en/developer-reference#version">“version” message</a>.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>106</p></td>
<td><p><a class="reference external" href="https://github.com/bitcoin/bitcoin/commit/cc0b4c3b62367a2aebe5fc1f4d0ed4b97e9c2ac9">Bitcoin Core 0.1.6</a> (Oct 2009)</p></td>
<td><ul class="simple">
<li><p>Added transmitter IP address fields, nonce, and User Agent (subVer) to <a class="reference external" href="/en/developer-reference#version">“version” message</a>.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="message-headers">
<h2>Message Headers<a class="headerlink" href="#message-headers" title="Permalink to this headline">¶</a></h2>
<p>All messages in the <a class="reference external" href="/en/developer-guide#term-network">network</a> protocol use the same container format, which provides a required multi-field message header and an optional payload. The message header format is:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 2%" />
<col style="width: 4%" />
<col style="width: 3%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4</p></td>
<td><p>start string</p></td>
<td><p>char[4]</p></td>
<td><p>Magic bytes indicating the originating <a class="reference external" href="/en/developer-guide#term-network">network</a>; used to seek to next message when stream state is unknown.</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>command name</p></td>
<td><p>char[12]</p></td>
<td><p>ASCII string which identifies what message type is contained in the payload. Followed by nulls (0x00) to pad out byte count; for example: <code class="docutils literal notranslate"><span class="pre">version\0\0\0\0\0</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>payload size</p></td>
<td><p>uint32_t</p></td>
<td><p>Number of bytes in payload. The current maximum number of bytes (<a class="reference external" href="https://github.com/bitcoin/bitcoin/blob/60abd463ac2eaa8bc1d616d8c07880dc53d97211/src/serialize.h#L23">“MAX_SIZE”</a>) allowed in the payload by Bitcoin Core is 32 MiB—messages with a payload size larger than this will be dropped or rejected.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>checksum</p></td>
<td><p>char[4]</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 209</a><em>.</em> First 4 bytes of SHA256(SHA256(payload)) in internal byte order. If payload is empty, as in <code class="docutils literal notranslate"><span class="pre">verack</span></code> and <a class="reference external" href="/en/developer-reference#getaddr">“getaddr” messages</a>, the checksum is always 0x5df6e0e2 (SHA256(SHA256(&lt;empty string&gt;))).</p></td>
</tr>
</tbody>
</table>
<p>The following example is an annotated hex dump of a mainnet message header from a <a class="reference external" href="/en/developer-reference#verack">“verack” message</a> which has no payload.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>f9beb4d9 ................... Start string: Mainnet
76657261636b000000000000 ... Command name: verack + null padding
00000000 ................... Byte count: 0
5df6e0e2 ................... Checksum: SHA256(SHA256(&lt;empty&gt;))
</pre></div>
</div>
</div>
<div class="section" id="data-messages">
<h2>Data Messages<a class="headerlink" href="#data-messages" title="Permalink to this headline">¶</a></h2>
<p>The following <a class="reference external" href="/en/developer-guide#term-network">network</a> messages all request or provide data related to transactions and blocks.</p>
<div class="figure align-center" id="id1">
<img alt="Overview Of P2P Protocol Data Request And Reply Messages" src="../_images/en-p2p-data-messages.svg" /><p class="caption"><span class="caption-text">Overview Of P2P Protocol Data Request And Reply Messages</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>Many of the data messages use <a class="reference external" href="../reference/glossary.html#inventory">inventories</a> as unique identifiers for transactions and blocks. Inventories have a simple 36-byte structure:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 6%" />
<col style="width: 16%" />
<col style="width: 10%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4</p></td>
<td><p>type identifier</p></td>
<td><p>uint32_t</p></td>
<td><p>The type of object which was hashed. See list of type identifiers below.</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
<td><p>hash</p></td>
<td><p>char[32]</p></td>
<td><p>SHA256(SHA256()) hash of the object in internal byte order.</p></td>
</tr>
</tbody>
</table>
<p>The currently-available type identifiers are:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 3%" />
<col style="width: 15%" />
<col style="width: 82%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type Identifier</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p><a class="reference external" href="/en/developer-reference#term-msg_tx">“MSG_TX”</a></p></td>
<td><p>The hash is a TXID.</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><a class="reference external" href="/en/developer-reference#term-msg_block">“MSG_BLOCK”</a></p></td>
<td><p>The hash is of a block header.</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><a class="reference external" href="/en/developer-reference#term-msg_block">“MSG_FILTERED_BLOCK”</a></p></td>
<td><p>The hash is of a block header; identical to <a class="reference external" href="/en/developer-reference#term-msg_block">“MSG_BLOCK”</a>. When used in a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a>, this indicates the response should be a <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> rather than a <a class="reference external" href="/en/developer-reference#block">“block” message</a> (but this only works if a bloom filter was previously configured). <strong>Only for use in</strong><a class="reference external" href="/en/developer-reference#getdata">“getdata” messages</a><strong>.</strong></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><a class="reference external" href="/en/developer-reference#term-msg_cmpct_block">“MSG_CMPCT_BLOCK”</a></p></td>
<td><p>The hash is of a block header; identical to <a class="reference external" href="/en/developer-reference#term-msg_block">“MSG_BLOCK”</a>. When used in a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a>, this indicates the response should be a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a>. <strong>Only for use in</strong><a class="reference external" href="/en/developer-reference#getdata">“getdata” messages</a><strong>.</strong></p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p><a class="reference external" href="/en/developer-reference#term-msg_witness_block">“MSG_WITNESS_BLOCK”</a></p></td>
<td><p>The hash is of a block header; identical to <a class="reference external" href="/en/developer-reference#term-msg_block">“MSG_BLOCK”</a>. When used in a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a>, this indicates the response should be a block message with transactions that have a witness using witness serialization. <strong>Only for use in</strong><a class="reference external" href="/en/developer-reference#getdata">“getdata” messages</a><strong>.</strong></p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p><a class="reference external" href="/en/developer-reference#term-msg_witness_tx">“MSG_WITNESS_TX”</a></p></td>
<td><p>The hash is a TXID. When used in a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a>, this indicates the response should be a transaction message, if the witness structure is nonempty, the witness serialization will be used. <strong>Only for use in</strong><a class="reference external" href="/en/developer-reference#getdata">“getdata” messages</a><strong>.</strong></p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p><a class="reference external" href="/en/developer-reference#term-msg_filtered_witness_block">“MSG_FILTERED_WITNESS_BLOCK”</a></p></td>
<td><p>Reserved for future use, not used as of <a class="reference external" href="/en/developer-reference#protocol-versions">Protocol Version 70015</a>.</p></td>
</tr>
</tbody>
</table>
<p>Type identifier zero and type identifiers greater than three are reserved for future implementations. Bitcoin Core ignores all inventories with one of these unknown types.</p>
<div class="section" id="block">
<h3>Block<a class="headerlink" href="#block" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#block">“block” message</a> transmits a single serialized block in the format described in the <a class="reference external" href="/en/developer-reference#serialized-blocks">serialized blocks section</a>. See that section for an example hexdump. It can be sent for two different reasons:</p>
<ol class="arabic simple">
<li><p><strong>GetData Response:</strong> Nodes will always send it in response to a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> that requests the block with an inventory type of <a class="reference external" href="/en/developer-reference#term-msg_block">“MSG_BLOCK”</a> (provided the node has that block available for relay).</p></li>
<li><p><strong>Unsolicited:</strong> Some miners will send unsolicited <a class="reference external" href="/en/developer-reference#block">“block” messages</a> broadcasting their newly-mined blocks to all of their peers. Many mining pools do the same thing, although some may be misconfigured to send the block from multiple nodes, possibly sending the same block to some peers more than once.</p></li>
</ol>
</div>
<div class="section" id="getblocks">
<h3>GetBlocks<a class="headerlink" href="#getblocks" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#getblocks">“getblocks” message</a> requests an <a class="reference external" href="/en/developer-reference#inv">“inv” message</a> that provides block header hashes starting from a particular point in the block chain. It allows a peer which has been disconnected or started for the first time to get the data it needs to request the blocks it hasn’t seen.</p>
<p>Peers which have been disconnected may have stale blocks in their locally-stored block chain, so the <a class="reference external" href="/en/developer-reference#getblocks">“getblocks” message</a> allows the requesting peer to provide the receiving peer with multiple header hashes at various heights on their local chain. This allows the receiving peer to find, within that list, the last header hash they had in common and reply with all subsequent header hashes.</p>
<p>Note: the receiving peer itself may respond with an <a class="reference external" href="/en/developer-reference#inv">“inv” message</a> containing header hashes of stale blocks. It is up to the requesting peer to poll all of its peers to find the best block chain.</p>
<p>If the receiving peer does not find a common header hash within the list, it will assume the last common block was the genesis block (block zero), so it will reply with in <a class="reference external" href="/en/developer-reference#inv">“inv” message</a> containing header hashes starting with block one (the first block after the genesis block).</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 2%" />
<col style="width: 4%" />
<col style="width: 4%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4</p></td>
<td><p>version</p></td>
<td><p>uint32_t</p></td>
<td><p>The protocol version number; the same as sent in the <a class="reference external" href="/en/developer-reference#version">“version” message</a>.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>hash count</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of header hashes provided not including the stop hash. There is no limit except that the byte size of the entire message must be below the <a class="reference external" href="https://github.com/bitcoin/bitcoin/blob/60abd463ac2eaa8bc1d616d8c07880dc53d97211/src/serialize.h#L23">“MAX_SIZE”</a> limit; typically from 1 to 200 hashes are sent.</p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>block header hashes</p></td>
<td><p>char[32]</p></td>
<td><p>One or more block header hashes (32 bytes each) in internal byte order. Hashes should be provided in reverse order of block height, so highest-height hashes are listed first and lowest-height hashes are listed last.</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
<td><p>stop hash</p></td>
<td><p>char[32]</p></td>
<td><p>The header hash of the last header hash being requested; set to all zeroes to request an <a class="reference external" href="/en/developer-reference#inv">“inv” message</a> with all subsequent header hashes (a maximum of 500 will be sent as a reply to this message; if you need more than 500, you will need to send another <a class="reference external" href="/en/developer-reference#getblocks">“getblocks” message</a> with a higher-height header hash as the first entry in block header hash field).</p></td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows a <a class="reference external" href="/en/developer-reference#getblocks">“getblocks” message</a>. (The message header has been omitted.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>71110100 ........................... Protocol version: 70001
02 ................................. Hash count: 2

d39f608a7775b537729884d4e6633bb2
105e55a16a14d31b0000000000000000 ... Hash #1

5c3e6403d40837110a2e8afb602b1c01
714bda7ce23bea0a0000000000000000 ... Hash #2

00000000000000000000000000000000
00000000000000000000000000000000 ... Stop hash
</pre></div>
</div>
</div>
<div class="section" id="getdata">
<h3>GetData<a class="headerlink" href="#getdata" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> requests one or more data objects from another node. The objects are requested by an inventory, which the requesting node typically received previously by way of an <a class="reference external" href="/en/developer-reference#inv">“inv” message</a>.</p>
<p>The response to a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> can be a <a class="reference external" href="/en/developer-reference#tx">“tx” message</a>, <a class="reference external" href="/en/developer-reference#block">“block” message</a>, <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a>, <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a>, or <a class="reference external" href="/en/developer-reference#notfound">“notfound” message</a>.</p>
<p>This message cannot be used to request arbitrary data, such as historic transactions no longer in the memory pool or relay set. Full nodes may not even be able to provide older blocks if they’ve pruned old transactions from their block database. For this reason, the <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> should usually only be used to request data from a node which previously advertised it had that data by sending an <a class="reference external" href="/en/developer-reference#inv">“inv” message</a>.</p>
<p>The format and maximum size limitations of the <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> are identical to the <a class="reference external" href="/en/developer-reference#inv">“inv” message</a>; only the message header differs.</p>
</div>
<div class="section" id="getheaders">
<h3>GetHeaders<a class="headerlink" href="#getheaders" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 31800</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#getheaders">“getheaders” message</a> requests a <a class="reference external" href="/en/developer-reference#headers">“headers” message</a> that provides block headers starting from a particular point in the block chain. It allows a peer which has been disconnected or started for the first time to get the headers it hasn’t seen yet.</p>
<p>The <a class="reference external" href="/en/developer-reference#getheaders">“getheaders” message</a> is nearly identical to the <a class="reference external" href="/en/developer-reference#getblocks">“getblocks” message</a>, with one minor difference: the <code class="docutils literal notranslate"><span class="pre">inv</span></code> reply to the <a class="reference external" href="/en/developer-reference#getblocks">“getblocks” message</a> will include no more than 500 block header hashes; the <code class="docutils literal notranslate"><span class="pre">headers</span></code> reply to the <a class="reference external" href="/en/developer-reference#getheaders">“getheaders” message</a> will include as many as 2,000 block headers.</p>
</div>
<div class="section" id="headers">
<h3>Headers<a class="headerlink" href="#headers" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 31800</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#headers">“headers” message</a> sends block headers to a node which previously requested certain headers with a <a class="reference external" href="/en/developer-reference#getheaders">“getheaders” message</a>. A headers message can be empty.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 3%" />
<col style="width: 3%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>count</p></td>
<td><p>compactSize uint</p></td>
<td><p>Number of block headers up to a maximum of 2,000. Note: headers-first sync assumes the sending node will send the maximum number of headers whenever possible.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>headers</p></td>
<td><p>block_header</p></td>
<td><p>Block headers: each 80-byte block header is in the format described in the <a class="reference external" href="/en/developer-reference#block-headers">block headers section</a> with an additional 0x00 suffixed. This 0x00 is called the transaction count, but because the headers message doesn’t include any transactions, the transaction count is always zero.</p></td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows a <a class="reference external" href="/en/developer-reference#headers">“headers” message</a>. (The message header has been omitted.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>01 ................................. Header count: 1

02000000 ........................... Block version: 2
b6ff0b1b1680a2862a30ca44d346d9e8
910d334beb48ca0c0000000000000000 ... Hash of previous block&#39;s header
9d10aa52ee949386ca9385695f04ede2
70dda20810decd12bc9b048aaab31471 ... Merkle root
24d95a54 ........................... [Unix time][unix epoch time]: 1415239972
30c31b18 ........................... Target (bits)
fe9f0864 ........................... Nonce

00 ................................. Transaction count (0x00)
</pre></div>
</div>
</div>
<div class="section" id="inv">
<h3>Inv<a class="headerlink" href="#inv" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#inv">“inv” message</a> (inventory message) transmits one or more inventories of objects known to the transmitting peer. It can be sent unsolicited to announce new transactions or blocks, or it can be sent in reply to a <a class="reference external" href="/en/developer-reference#getblocks">“getblocks” message</a> or <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a>.</p>
<p>The receiving peer can compare the inventories from an <a class="reference external" href="/en/developer-reference#inv">“inv” message</a> against the inventories it has already seen, and then use a follow-up message to request unseen objects.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 17%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>count</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of inventory entries.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>inventory</p></td>
<td><p>inventory</p></td>
<td><p>One or more inventory entries up to a maximum of 50,000 entries.</p></td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows an <a class="reference external" href="/en/developer-reference#inv">“inv” message</a> with two inventory entries. (The message header has been omitted.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>02 ................................. Count: 2

01000000 ........................... Type: MSG_TX
de55ffd709ac1f5dc509a0925d0b1fc4
42ca034f224732e429081da1b621f55a ... Hash (TXID)

01000000 ........................... Type: MSG_TX
91d36d997037e08018262978766f24b8
a055aaf1d872e94ae85e9817b2c68dc7 ... Hash (TXID)
</pre></div>
</div>
</div>
<div class="section" id="mempool">
<h3>MemPool<a class="headerlink" href="#mempool" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 60002</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a> requests the TXIDs of transactions that the receiving node has verified as valid but which have not yet appeared in a block. That is, transactions which are in the receiving node’s memory pool. The response to the <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a> is one or more <a class="reference external" href="/en/developer-reference#inv">“inv” messages</a> containing the TXIDs in the usual inventory format.</p>
<p>Sending the <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a> is mostly useful when a program first connects to the <a class="reference external" href="/en/developer-guide#term-network">network</a>. Full nodes can use it to quickly gather most or all of the unconfirmed transactions available on the <a class="reference external" href="/en/developer-guide#term-network">network</a>; this is especially useful for miners trying to gather transactions for their transaction fees. SPV clients can set a filter before sending a <code class="docutils literal notranslate"><span class="pre">mempool</span></code> to only receive transactions that match that filter; this allows a recently-started client to get most or all unconfirmed transactions related to its wallet.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">inv</span></code> response to the <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a> is, at best, one node’s view of the <a class="reference external" href="/en/developer-guide#term-network">network</a>—not a complete list of unconfirmed transactions on the <a class="reference external" href="/en/developer-guide#term-network">network</a>. Here are some additional reasons the list might not be complete:</p>
<ul class="simple">
<li><p>Before <a class="reference external" href="/en/release/v0.9.0">Bitcoin Core 0.9.0</a>, the response to the <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a> was only one <a class="reference external" href="/en/developer-reference#inv">“inv” message</a>. An <a class="reference external" href="/en/developer-reference#inv">“inv” message</a> is limited to 50,000 inventories, so a node with a memory pool larger than 50,000 entries would not send everything. Later versions of Bitcoin Core send as many <a class="reference external" href="/en/developer-reference#inv">“inv” messages</a> as needed to reference its complete memory pool.</p></li>
<li><p>The <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a> is not currently fully compatible with the <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message’s</a> <code class="docutils literal notranslate"><span class="pre">BLOOM_UPDATE_ALL</span></code> and <code class="docutils literal notranslate"><span class="pre">BLOOM_UPDATE_P2PUBKEY_ONLY</span></code> flags. Mempool transactions are not sorted like in-block transactions, so a transaction (tx2) spending an output can appear before the transaction (tx1) containing that output, which means the automatic filter update mechanism won’t operate until the second-appearing transaction (tx1) is seen—missing the first-appearing transaction (tx2). It has been proposed in <a class="reference external" href="https://github.com/bitcoin/bitcoin/issues/2381">Bitcoin Core issue #2381</a> that the transactions should be sorted before being processed by the filter.</p></li>
</ul>
<p>There is no payload in a <a class="reference external" href="/en/developer-reference#mempool">“mempool” message</a>. See the <a class="reference external" href="/en/developer-reference#message-headers">message header section</a> for an example of a message without a payload.</p>
</div>
<div class="section" id="merkleblock">
<h3>MerkleBlock<a class="headerlink" href="#merkleblock" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70001</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> is a reply to a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> which requested a block using the inventory type <code class="docutils literal notranslate"><span class="pre">MSG_MERKLEBLOCK</span></code>. It is only part of the reply: if any matching transactions are found, they will be sent separately as <a class="reference external" href="/en/developer-reference#tx">“tx” messages</a>.</p>
<p>If a filter has been previously set with the <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a>, the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> will contain the TXIDs of any transactions in the requested block that matched the filter, as well as any parts of the block’s merkle tree necessary to connect those transactions to the block header’s merkle root. The message also contains a complete copy of the block header to allow the client to hash it and confirm its proof of work.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 3%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 84%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>80</p></td>
<td><p>block header</p></td>
<td><p>block_header</p></td>
<td><p>The block header in the format described in the <a class="reference external" href="/en/developer-reference#block-headers">block header section</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>transaction count</p></td>
<td><p>uint32_t</p></td>
<td><p>The number of transactions in the block (including ones that don’t match the filter).</p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>hash count</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of hashes in the following field.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>hashes</p></td>
<td><p>char[32]</p></td>
<td><p>One or more hashes of both transactions and merkle nodes in internal byte order. Each hash is 32 bytes.</p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>flag byte count</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of flag bytes in the following field.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>flags</p></td>
<td><p>byte[]</p></td>
<td><p>A sequence of bits packed eight in a byte with the least significant bit first. May be padded to the nearest byte boundary but must not contain any more bits than that. Used to assign the hashes to particular nodes in the merkle tree as described below.</p></td>
</tr>
</tbody>
</table>
<p>The annotated hexdump below shows a <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> which corresponds to the examples below. (The message header has been omitted.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>01000000 ........................... Block version: 1
82bb869cf3a793432a66e826e05a6fc3
7469f8efb7421dc88067010000000000 ... Hash of previous block&#39;s header
7f16c5962e8bd963659c793ce370d95f
093bc7e367117b3c30c1f8fdd0d97287 ... Merkle root
76381b4d ........................... Time: 1293629558
4c86041b ........................... nBits: 0x04864c * 256**(0x1b-3)
554b8529 ........................... Nonce

07000000 ........................... Transaction count: 7
04 ................................. Hash count: 4

3612262624047ee87660be1a707519a4
43b1c1ce3d248cbfc6c15870f6c5daa2 ... Hash #1
019f5b01d4195ecbc9398fbf3c3b1fa9
bb3183301d7a1fb3bd174fcfa40a2b65 ... Hash #2
41ed70551dd7e841883ab8f0b16bf041
76b7d1480e4f0af9f3d4c3595768d068 ... Hash #3
20d2a7bc994987302e5b1ac80fc425fe
25f8b63169ea78e68fbaaefa59379bbf ... Hash #4

01 ................................. Flag bytes: 1
1d ................................. Flags: 1 0 1 1 1 0 0 0
</pre></div>
</div>
<p>Note: when fully decoded, the above <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> provided the TXID for a single transaction that matched the filter. In the <a class="reference external" href="/en/developer-guide#term-network">network</a> traffic dump this output was taken from, the full transaction belonging to that TXID was sent immediately after the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> as a <a class="reference external" href="/en/developer-reference#tx">“tx” message</a>.</p>
<div class="section" id="parsing-a-merkleblock-message">
<h4>Parsing A MerkleBlock Message<a class="headerlink" href="#parsing-a-merkleblock-message" title="Permalink to this headline">¶</a></h4>
<p>As seen in the annotated hexdump above, the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> provides three special data types: a transaction count, a list of hashes, and a list of one-bit flags.</p>
<p>You can use the transaction count to construct an empty merkle tree. We’ll call each entry in the tree a node; on the bottom are TXID nodes—the hashes for these nodes are TXIDs; the remaining nodes (including the merkle root) are non-TXID nodes—they may actually have the same hash as a TXID, but we treat them differently.</p>
<div class="figure align-center" id="id2">
<img alt="Example Of Parsing A MerkleBlock Message" src="../_images/animated-en-merkleblock-parsing.gif" />
<p class="caption"><span class="caption-text">Example Of Parsing A MerkleBlock Message</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>Keep the hashes and flags in the order they appear in the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a>. When we say “next flag” or “next hash”, we mean the next flag or hash on the list, even if it’s the first one we’ve used so far.</p>
<p>Start with the merkle root node and the first flag. The table below describes how to evaluate a flag based on whether the node being processed is a TXID node or a non-TXID node. Once you apply a flag to a node, never apply another flag to that same node or reuse that same flag again.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 2%" />
<col style="width: 29%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Flag</p></th>
<th class="head"><p>TXID Node</p></th>
<th class="head"><p>Non-TXID Node</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>0</strong></p></td>
<td><p>Use the next hash as this node’s TXID, but this transaction didn’t match the filter.</p></td>
<td><p>Use the next hash as this node’s hash. Don’t process any descendant nodes.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>1</strong></p></td>
<td><p>Use the next hash as this node’s TXID, and mark this transaction as matching the filter.</p></td>
<td><p>The hash needs to be computed. Process the left child node to get its hash; process the right child node to get its hash; then concatenate the two hashes as 64 raw bytes and hash them to get this node’s hash.</p></td>
</tr>
</tbody>
</table>
<p>Any time you begin processing a node for the first time, evaluate the next flag. Never use a flag at any other time.</p>
<p>When processing a child node, you may need to process its children (the grandchildren of the original node) or further-descended nodes before returning to the parent node. This is expected—keep processing depth first until you reach a TXID node or a non-TXID node with a flag of 0.</p>
<p>After you process a TXID node or a non-TXID node with a flag of 0, stop processing flags and begin to ascend the tree. As you ascend, compute the hash of any nodes for which you now have both child hashes or for which you now have the sole child hash. See the <a class="reference external" href="/en/developer-reference#merkle-trees">merkle tree section</a> for hashing instructions. If you reach a node where only the left hash is known, descend into its right child (if present) and further descendants as necessary.</p>
<p>However, if you find a node whose left and right children both have the same hash, fail. This is related to <a class="reference external" href="https://en.bitcoin.it/wiki/CVEs#CVE-2012-2459">CVE-2012-2459</a>.</p>
<p>Continue descending and ascending until you have enough information to obtain the hash of the merkle root node. If you run out of flags or hashes before that condition is reached, fail. Then perform the following checks (order doesn’t matter):</p>
<ul class="simple">
<li><p>Fail if there are unused hashes in the hashes list.</p></li>
<li><p>Fail if there are unused flag bits—except for the minimum number of bits necessary to pad up to the next full byte.</p></li>
<li><p>Fail if the hash of the merkle root node is not identical to the merkle root in the block header.</p></li>
<li><p>Fail if the block header is invalid. Remember to ensure that the hash of the header is less than or equal to the target threshold encoded by the nBits header field. Your program should also, of course, attempt to ensure the header belongs to the best block chain and that the user knows how many confirmations this block has.</p></li>
</ul>
<p>For a detailed example of parsing a <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a>, please see the corresponding <a class="reference external" href="/en/developer-examples#parsing-a-merkleblock">merkle block examples section</a>.</p>
</div>
<div class="section" id="creating-a-merkleblock-message">
<h4>Creating A MerkleBlock Message<a class="headerlink" href="#creating-a-merkleblock-message" title="Permalink to this headline">¶</a></h4>
<p>It’s easier to understand how to create a <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> after you understand how to parse an already-created message, so we recommend you read the parsing section above first.</p>
<p>Create a complete merkle tree with TXIDs on the bottom row and all the other hashes calculated up to the merkle root on the top row. For each transaction that matches the filter, track its TXID node and all of its ancestor nodes.</p>
<div class="figure align-center" id="id3">
<img alt="Example Of Creating A MerkleBlock Message" src="../_images/animated-en-merkleblock-creation.gif" />
<p class="caption"><span class="caption-text">Example Of Creating A MerkleBlock Message</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>Start processing the tree with the merkle root node. The table below describes how to process both TXID nodes and non-TXID nodes based on whether the node is a match, a match ancestor, or neither a match nor a match ancestor.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 13%" />
<col style="width: 25%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>TXID Node</p></th>
<th class="head"><p>Non-TXID Node</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Neither Match Nor Match Ancestor</strong></p></td>
<td><p>Append a 0 to the flag list; append this node’s TXID to the hash list.</p></td>
<td><p>Append a 0 to the flag list; append this node’s hash to the hash list. Do not descend into its child nodes.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Match Or Match Ancestor</strong></p></td>
<td><p>Append a 1 to the flag list; append this node’s TXID to the hash list.</p></td>
<td><p>Append a 1 to the flag list; process the left child node. Then, if the node has a right child, process the right child. Do not append a hash to the hash list for this node.</p></td>
</tr>
</tbody>
</table>
<p>Any time you begin processing a node for the first time, a flag should be appended to the flag list. Never put a flag on the list at any other time, except when processing is complete to pad out the flag list to a byte boundary.</p>
<p>When processing a child node, you may need to process its children (the grandchildren of the original node) or further-descended nodes before returning to the parent node. This is expected—keep processing depth first until you reach a TXID node or a node which is neither a TXID nor a match ancestor.</p>
<p>After you process a TXID node or a node which is neither a TXID nor a match ancestor, stop processing and begin to ascend the tree until you find a node with a right child you haven’t processed yet. Descend into that right child and process it.</p>
<p>After you fully process the merkle root node according to the instructions in the table above, processing is complete. Pad your flag list to a byte boundary and construct the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> using the template near the beginning of this subsection.</p>
</div>
</div>
<div class="section" id="cmpctblock">
<h3>CmpctBlock<a class="headerlink" href="#cmpctblock" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70014</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP152</a><em>.</em></p>
<p><strong>Version 1 compact blocks are pre-segwit (txids)</strong> <strong>Version 2 compact blocks are post-segwit (wtxids)</strong></p>
<p>The <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> is a reply to a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> which requested a block using the inventory type <a class="reference external" href="/en/developer-reference#term-msg_cmpct_block">“MSG_CMPCT_BLOCK”</a>. If the requested block was recently announced and is close to the tip of the best chain of the receiver and after having sent the requesting peer a <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” message</a>, nodes respond with a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> containing data for the block.</p>
<p><strong>If the requested block is too old, the node responds with a full non-compact block</strong></p>
<p>Upon <a class="reference external" href="/en/developer-guide#term-receipt">receipt</a> of a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a>, after sending a <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” message</a>, nodes should calculate the short transaction ID for each unconfirmed transaction they have available (ie in their mempool) and compare each to each short transaction ID in the <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a>. After finding already-available transactions, nodes which do not have all transactions available to reconstruct the full block should request the missing transactions using a <a class="reference external" href="/en/developer-reference#getblocktxn">“getblocktxn” message</a>.</p>
<p>A node must not send a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> unless they are able to respond to a <a class="reference external" href="/en/developer-reference#getblocktxn">“getblocktxn” message</a> which requests every transaction in the block. A node must not send a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> without having validated that the header properly commits to each transaction in the block, and properly builds on top of the existing, fully-validated chain with a valid proof-of-work either as a part of the current most-work valid chain, or building directly on top of it. A node may send a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> before validating that each transaction in the block validly spends existing UTXO set entries.</p>
<p>The <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> contains a vector of <a class="reference external" href="/en/developer-reference#cmpctblock">“PrefilledTransaction”</a> whose structure is defined below.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 7%" />
<col style="width: 18%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>index</p></td>
<td><p>compactSize uint</p></td>
<td><p>The index into the block at which this transaction is located.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>tx</p></td>
<td><p>Transaction</p></td>
<td><p>The transaction which is in the block at the index.</p></td>
</tr>
</tbody>
</table>
<p>The <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> is compromised of a serialized <a class="reference external" href="/en/developer-reference#cmpctblock">“HeaderAndShortIDs”</a> structure which is defined below. A <a class="reference external" href="/en/developer-reference#cmpctblock">“HeaderAndShortIDs”</a> structure is used to relay a block header, the short transactions IDs used for matching already-available transactions, and a select few transactions which we expect a peer may be missing.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 2%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 87%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>80</p></td>
<td><p>block header</p></td>
<td><p>block_header</p></td>
<td><p>The block header in the format described in the <a class="reference external" href="/en/developer-reference#block-headers">block header section</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>nonce</p></td>
<td><p>uint64_t</p></td>
<td><p>A nonce for use in short transaction ID calculations.</p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>shortids length</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of short transaction IDs in the following field.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>shortids</p></td>
<td><p>byte[]</p></td>
<td><p>The short transaction IDs calculated from the transactions which were not provided explicitly in prefilledtxn. Vector of 6-byte integers in the spec, padded with two null-bytes so it can be read as an 8-byte integer. <strong>In version 2 of compact blocks, shortids should use the wtxid instead of txid as defined by</strong><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP141</a></p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>prefilled txn length</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of prefilled transactions in the following field.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>prefilled txn</p></td>
<td><p>PrefilledTransaction[]</p></td>
<td><p>Used to provide the coinbase transaction and a select few which we expect a peer may be missing. Vector of <a class="reference external" href="/en/developer-reference#cmpctblock">“PrefilledTransaction”</a> structures defined above.</p></td>
</tr>
</tbody>
</table>
<p><strong>Important</strong><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70015</a><strong>notes regarding Compact Blocks</strong></p>
<p>New banning behavior was added to the compact block logic in <a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70015</a> to prevent node abuse, the new changes are outlined below as defined in <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP152</a>.</p>
<p>Any undefined behavior in this spec may cause failure to transfer block to, peer disconnection by, or self-destruction by the receiving node. A node receiving non-minimally-encoded CompactSize encodings should make a best-effort to eat the sender’s cat.</p>
<p>As high-bandwidth mode permits relaying of <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” messages</a> prior to full validation (requiring only that the block header is valid before relay), nodes SHOULD NOT ban a peer for announcing a new block with a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> that is invalid, but has a valid header.</p>
<p>For avoidance of doubt, nodes SHOULD bump their <a class="reference external" href="/en/developer-guide#term-network">peer-to-peer</a> protocol version to 70015 or higher to signal that they will not ban or punish a peer for announcing compact blocks prior to full validation, and nodes SHOULD NOT announce a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> to a peer with a version number below 70015 before fully validating the block.</p>
<p><strong>Version 2 compact blocks notes</strong></p>
<p>Transactions inside <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” messages</a> (both those used as direct announcement and those in response to getdata) and in <a class="reference external" href="/en/developer-reference#blocktxn">“blocktxn” messages</a> should include witness data, using the same format as responses to getdata <a class="reference external" href="/en/developer-reference#term-msg_witness_tx">“MSG_WITNESS_TX”</a>, specified in <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki">BIP144</a>.</p>
<p>Upon <a class="reference external" href="/en/developer-guide#term-receipt">receipt</a> of a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> containing a request for a <a class="reference external" href="/en/developer-reference#term-msg_cmpct_block">“MSG_CMPCT_BLOCK”</a> object for which a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> is not sent in response, the block message containing the requested block in non-compact form MUST be encoded with witnesses (as is sent in reply to a <a class="reference external" href="/en/developer-reference#term-msg_witness_block">“MSG_WITNESS_BLOCK”</a>) if the protocol version used to encode the <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> would have been 2, and encoded without witnesses (as is sent in response to a <a class="reference external" href="/en/developer-reference#term-msg_block">“MSG_BLOCK”</a>) if the protocol version used to encode the <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> would have been 1.</p>
<p><strong>Short Transaction ID calculation</strong></p>
<p>Short transaction IDs are used to represent a transaction without sending a full 256-bit hash. They are calculated as follows,</p>
<ul class="simple">
<li><p>A single-SHA256 hashing the block header with the nonce appended (in little-endian)</p></li>
<li><p>Running SipHash-2-4 with the input being the transaction ID (<strong>wtxid in version 2 of compact blocks</strong>) and the keys (k0/k1) set to the first two little-endian 64-bit integers from the above hash, respectively.</p></li>
<li><p>Dropping the 2 most significant bytes from the SipHash output to make it 6 bytes.</p></li>
<li><p>Two null-bytes appended so it can be read as an 8-byte integer.</p></li>
</ul>
</div>
<div class="section" id="sendcmpct">
<h3>SendCmpct<a class="headerlink" href="#sendcmpct" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70014</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP152</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” message</a> is defined as a message containing a 1-byte integer followed by a 8-byte integer. The first integer is interpreted as a boolean and should have a value of either 1 or 0. The second integer is be interpreted as a little-endian version number.</p>
<p>Upon <a class="reference external" href="/en/developer-guide#term-receipt">receipt</a> of a <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” message</a> with the first and second integers set to 1, the node should announce new blocks by sending a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a>.</p>
<p>Upon <a class="reference external" href="/en/developer-guide#term-receipt">receipt</a> of a <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” message</a> with the first integer set to 0, the node shouldn’t announce new blocks by sending a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a>, but instead announce new blocks by sending invs or headers, as defined by <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0130.mediawiki">BIP130</a>.</p>
<p>Upon <a class="reference external" href="/en/developer-guide#term-receipt">receipt</a> of a <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” message</a> with the second integer set to something other than 1, nodes should treat the peer as if they had not received the message (as it indicates the peer will provide an unexpected encoding in <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” messages</a>, and/or other, messages). This allows future versions to send duplicate <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” messages</a> with different versions as a part of a version handshake for future versions.</p>
<p>Nodes should check for a protocol version of &gt;= 70014 before sending <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” messages</a>. Nodes shouldn’t send a request for a <a class="reference external" href="/en/developer-reference#term-msg_cmpct_block">“MSG_CMPCT_BLOCK”</a> object to a peer before having received a <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” message</a> from that peer. Nodes shouldn’t request a <a class="reference external" href="/en/developer-reference#term-msg_cmpct_block">“MSG_CMPCT_BLOCK”</a> object before having sent all <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” messages</a> to that peer which they intend to send, as the peer cannot know what version protocol to use in the response.</p>
<p>The structure of a <a class="reference external" href="/en/developer-reference#sendcmpct">“sendcmpct” message</a> is defined below.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 4%" />
<col style="width: 6%" />
<col style="width: 9%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>announce</p></td>
<td><p>block_header</p></td>
<td><p>An integer representing a boolean value, must be 1 or 0 (1 is true, 0 is false).</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>version</p></td>
<td><p>uint64_t</p></td>
<td><p>A little-endian representation of a version number. <strong>Version 2 compact blocks should be specified by setting version to 2</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="getblocktxn">
<h3>GetBlockTxn<a class="headerlink" href="#getblocktxn" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70014</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP152</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#getblocktxn">“getblocktxn” message</a> is defined as a message containing a serialized <a class="reference external" href="/en/developer-reference#getblocktxn">“BlockTransactionsRequest”</a> message. Upon <a class="reference external" href="/en/developer-guide#term-receipt">receipt</a> of a properly-formatted <a class="reference external" href="/en/developer-reference#getblocktxn">“getblocktxn” message</a>, nodes which recently provided the sender of such a message a <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> for the block hash identified in this message must respond with either an appropriate <a class="reference external" href="/en/developer-reference#blocktxn">“blocktxn” message</a>, or a full block message.</p>
<p>A <a class="reference external" href="/en/developer-reference#blocktxn">“blocktxn” message</a> response must contain exactly and only each transaction which is present in the appropriate block at the index specified in the <a class="reference external" href="/en/developer-reference#getblocktxn">“getblocktxn” message</a> indexes list, in the order requested.</p>
<p>The structure of <a class="reference external" href="/en/developer-reference#getblocktxn">“BlockTransactionsRequest”</a> is defined below.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 3%" />
<col style="width: 5%" />
<col style="width: 6%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>32</p></td>
<td><p>block hash</p></td>
<td><p>binary blob</p></td>
<td><p>The blockhash of the block which the transactions being requested are in.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>indexes length</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of transactions being requested.</p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>indexes</p></td>
<td><p>compactSize uint[]</p></td>
<td><p>Vector of compactSize containing the indexes of the transactions being requested in the block. <strong>In version 2 of compact blocks, the wtxid should be used instead of the txid as defined by</strong><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP141</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="blocktxn">
<h3>BlockTxn<a class="headerlink" href="#blocktxn" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70014</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki">BIP152</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#blocktxn">“blocktxn” message</a> is defined as a message containing a serialized <a class="reference external" href="/en/developer-reference#blocktxn">“BlockTransactions”</a> message. Upon <a class="reference external" href="/en/developer-guide#term-receipt">receipt</a> of a properly-formatted requested <a class="reference external" href="/en/developer-reference#blocktxn">“blocktxn” message</a>, nodes should attempt to reconstruct the full block by taking the prefilledtxn transactions from the original <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a> and placing them in the marked positions, then for each short transaction ID from the original <a class="reference external" href="/en/developer-reference#cmpctblock">“cmpctblock” message</a>, in order, find the corresponding transaction either from the <a class="reference external" href="/en/developer-reference#blocktxn">“blocktxn” message</a> or from other sources and place it in the first available position in the block then once the block has been reconstructed, it shall be processed as normal, keeping in mind that short transaction IDs are expected to occasionally collide, and that nodes must not be penalized for such collisions, wherever they appear.</p>
<p>The structure of <a class="reference external" href="/en/developer-reference#blocktxn">“BlockTransactions”</a> is defined below.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 5%" />
<col style="width: 10%" />
<col style="width: 8%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>32</p></td>
<td><p>block hash</p></td>
<td><p>binary blob</p></td>
<td><p>The blockhash of the block which the transactions being provided are in.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>transactions length</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of transactions being provided.</p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>transactions</p></td>
<td><p>Transactions[]</p></td>
<td><p>Vector of transactions, for an example hexdump of the raw transaction format, see the <a class="reference external" href="/en/developer-reference#raw-transaction-format">raw transaction section</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="notfound">
<h3>NotFound<a class="headerlink" href="#notfound" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70001</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#notfound">“notfound” message</a> is a reply to a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> which requested an object the receiving node does not have available for relay. (Nodes are not expected to relay historic transactions which are no longer in the memory pool or relay set. Nodes may also have pruned spent transactions from older blocks, making them unable to send those blocks.)</p>
<p>The format and maximum size limitations of the <a class="reference external" href="/en/developer-reference#notfound">“notfound” message</a> are identical to the <a class="reference external" href="/en/developer-reference#inv">“inv” message</a>; only the message header differs.</p>
</div>
<div class="section" id="tx">
<h3>Tx<a class="headerlink" href="#tx" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#tx">“tx” message</a> transmits a single transaction in the raw transaction format. It can be sent in a variety of situations;</p>
<ul class="simple">
<li><p><strong>Transaction Response:</strong> Bitcoin Core and <a class="reference external" href="http://bitcoinj.github.io">BitcoinJ</a> will send it in response to a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> that requests the transaction with an inventory type of <a class="reference external" href="/en/developer-reference#term-msg_tx">“MSG_TX”</a>.</p></li>
<li><p><strong>MerkleBlock Response:</strong> Bitcoin Core will send it in response to a <a class="reference external" href="/en/developer-reference#getdata">“getdata” message</a> that requests a merkle block with an inventory type of <code class="docutils literal notranslate"><span class="pre">MSG_MERKLEBLOCK</span></code>. (This is in addition to sending a <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a>.) Each <a class="reference external" href="/en/developer-reference#tx">“tx” message</a> in this case provides a matched transaction from that block.</p></li>
<li><p><strong>Unsolicited:</strong> <a class="reference external" href="http://bitcoinj.github.io">BitcoinJ</a> will send a <a class="reference external" href="/en/developer-reference#tx">“tx” message</a> unsolicited for transactions it originates.</p></li>
</ul>
<p>For an example hexdump of the raw transaction format, see the <a class="reference external" href="/en/developer-reference#raw-transaction-format">raw transaction section</a>.</p>
</div>
</div>
<div class="section" id="control-messages">
<h2>Control Messages<a class="headerlink" href="#control-messages" title="Permalink to this headline">¶</a></h2>
<p>The following <a class="reference external" href="/en/developer-guide#term-network">network</a> messages all help control the connection between two peers or allow them to advise each other about the rest of the <a class="reference external" href="/en/developer-guide#term-network">network</a>.</p>
<div class="figure align-center" id="id4">
<img alt="Overview Of P2P Protocol Control And Advisory Messages" src="../_images/en-p2p-control-messages.svg" /><p class="caption"><span class="caption-text">Overview Of P2P Protocol Control And Advisory Messages</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>Note that almost none of the control messages are authenticated in any way, meaning they can contain incorrect or intentionally harmful information. In addition, this section does not yet cover P2P protocol operation over the <a class="reference external" href="https://en.wikipedia.org/wiki/Tor_%28anonymity_network%29">Tor network</a>; if you would like to contribute information about Tor, please <a class="reference external" href="https://github.com/bitcoin-dot-org/bitcoin.org/issues">open an issue</a>.</p>
<div class="section" id="addr">
<h3>Addr<a class="headerlink" href="#addr" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">addr</span></code> (IP address) message relays connection information for peers on the <a class="reference external" href="/en/developer-guide#term-network">network</a>. Each peer which wants to accept incoming connections creates an <a class="reference external" href="/en/developer-reference#addr">“addr” message</a> providing its connection information and then sends that message to its peers unsolicited. Some of its peers send that information to their peers (also unsolicited), some of which further distribute it, allowing decentralized peer discovery for any program already on the <a class="reference external" href="/en/developer-guide#term-network">network</a>.</p>
<p>An <a class="reference external" href="/en/developer-reference#addr">“addr” message</a> may also be sent in response to a <a class="reference external" href="/en/developer-reference#getaddr">“getaddr” message</a>.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 5%" />
<col style="width: 8%" />
<col style="width: 27%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>IP address count</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of IP address entries up to a maximum of 1,000.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>IP addresses</p></td>
<td><p><a class="reference external" href="/en/developer-guide#term-network">network</a> IP address</p></td>
<td><p>IP address entries. See the table below for the format of a Bitcoin <a class="reference external" href="/en/developer-guide#term-network">network</a> IP address.</p></td>
</tr>
</tbody>
</table>
<p>Each encapsulated <a class="reference external" href="/en/developer-guide#term-network">network</a> IP address currently uses the following structure:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 2%" />
<col style="width: 95%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4</p></td>
<td><p>time</p></td>
<td><p>uint32</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 31402</a><em>.</em> A time in <a class="reference external" href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch time</a> format. Nodes advertising their own IP address set this to the current time. Nodes advertising IP addresses they’ve connected to set this to the last time they connected to that node. Other nodes just relaying the IP address should not change the time. Nodes can use the time field to avoid relaying old <a class="reference external" href="/en/developer-reference#addr">“addr” messages</a>. Malicious nodes may change times or even set them in the future.</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>services</p></td>
<td><p>uint64_t</p></td>
<td><p>The services the node advertised in its <a class="reference external" href="/en/developer-reference#version">“version” message</a>.</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>IP address</p></td>
<td><p>char</p></td>
<td><p>IPv6 address in <strong>big endian byte order</strong>. IPv4 addresses can be provided as <a class="reference external" href="http://en.wikipedia.org/wiki/IPv6#IPv4-mapped_IPv6_addresses">IPv4-mapped IPv6 addresses</a></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>port</p></td>
<td><p>uint16_t</p></td>
<td><p>Port number in <strong>big endian byte order</strong>. Note that Bitcoin Core will only connect to nodes with non-standard port numbers as a last resort for finding peers. This is to prevent anyone from trying to use the <a class="reference external" href="/en/developer-guide#term-network">network</a> to disrupt non-Bitcoin services that run on other ports.</p></td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows part of an <a class="reference external" href="/en/developer-reference#addr">“addr” message</a>. (The message header has been omitted and the actual IP address has been replaced with a <a class="reference external" href="http://tools.ietf.org/html/rfc5737">RFC5737</a> reserved IP address.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>fde803 ............................. Address count: 1000

d91f4854 ........................... [Epoch time][unix epoch time]: 1414012889
0100000000000000 ................... Service bits: 01 ([network][network] node)
00000000000000000000ffffc0000233 ... IP Address: ::ffff:192.0.2.51
208d ............................... Port: 8333

[...] .............................. (999 more addresses omitted)
</pre></div>
</div>
</div>
<div class="section" id="alert">
<h3>Alert<a class="headerlink" href="#alert" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 311</a><em>.</em> <em>Removed in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70013</a><em>and released in</em><a class="reference external" href="/en/release/v0.13.0">Bitcoin Core 0.13.0</a></p>
<p>The legacy p2p <a class="reference external" href="/en/developer-guide#term-network">network</a> alert messaging system has been retired; however, internal alerts, partition detection warnings and the <code class="docutils literal notranslate"><span class="pre">-alertnotify</span></code> option features remain. See <a class="reference external" href="https://bitcoin.org/en/alert/2016-11-01-alert-retirement">Alert System Retirement</a> for details.</p>
</div>
<div class="section" id="feefilter">
<h3>FeeFilter<a class="headerlink" href="#feefilter" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70013</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0133.mediawiki">BIP133</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#feefilter">“feefilter” message</a> is a request to the receiving peer to not relay any transaction inv messages to the sending peer where the fee rate for the transaction is below the fee rate specified in the feefilter message.</p>
<p><code class="docutils literal notranslate"><span class="pre">feefilter</span></code> was introduced in <a class="reference external" href="/en/release/v0.13.0">Bitcoin Core 0.13.0</a> following the introduction of mempool limiting in <a class="reference external" href="/en/release/v0.12.0">Bitcoin Core 0.12.0</a>. Mempool limiting provides protection against attacks and spam transactions that have low fee rates and are unlikely to be included in mined blocks. The <a class="reference external" href="/en/developer-reference#feefilter">“feefilter” messages</a> allows a node to inform its peers that it will not accept transactions below a specified fee rate into its mempool, and therefore that the peers can skip relaying inv messages for transactions below that fee rate to that node.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 5%" />
<col style="width: 7%" />
<col style="width: 9%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8</p></td>
<td><p>feerate</p></td>
<td><p>uint64_t</p></td>
<td><p>The fee rate (in satoshis per kilobyte) below which transactions should not be relayed to this peer.</p></td>
</tr>
</tbody>
</table>
<p>The receiving peer may choose to ignore the message and not filter transaction inv messages.</p>
<p>The fee filter is additive with bloom filters. If an SPV client loads a bloom filter and sends a feefilter message, transactions should only be relayed if they pass both filters.</p>
<p>Note however that feefilter has no effect on block propagation or responses to getdata messages. For example, if a node requests a merkleblock from its peer by sending a getdata message with inv type MSG_FILTERED_BLOCK and it has previously sent a feefilter to that peer, the peer should respond with a merkleblock containing <em>all</em> the transactions matching the bloom filter, even if they are below the feefilter fee rate.</p>
<p>inv messages generated from a mempool message are subject to a fee filter if it exists.</p>
<p>The annotated hexdump below shows a <a class="reference external" href="/en/developer-reference#feefilter">“feefilter” message</a>. (The message header has been omitted.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>7cbd000000000000 ... satoshis per kilobyte: 48,508
</pre></div>
</div>
</div>
<div class="section" id="filteradd">
<h3>FilterAdd<a class="headerlink" href="#filteradd" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70001</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#filteradd">“filteradd” message</a> tells the receiving peer to add a single element to a previously-set bloom filter, such as a new public key. The element is sent directly to the receiving peer; the peer then uses the parameters set in the <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a> to add the element to the bloom filter.</p>
<p>Because the element is sent directly to the receiving peer, there is no obfuscation of the element and none of the plausible-deniability privacy provided by the bloom filter. Clients that want to maintain greater privacy should recalculate the bloom filter themselves and send a new <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a> with the recalculated bloom filter.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 3%" />
<col style="width: 4%" />
<col style="width: 5%" />
<col style="width: 88%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>element bytes</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of bytes in the following element field.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>element</p></td>
<td><p>uint8_t[]</p></td>
<td><p>The element to add to the current filter. Maximum of 520 bytes, which is the maximum size of an element which can be pushed onto the stack in a pubkey or signature script. Elements must be sent in the byte order they would use when appearing in a raw transaction; for example, hashes should be sent in internal byte order.</p></td>
</tr>
</tbody>
</table>
<p>Note: a <a class="reference external" href="/en/developer-reference#filteradd">“filteradd” message</a> will not be accepted unless a filter was previously set with the <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a>.</p>
<p>The annotated hexdump below shows a <a class="reference external" href="/en/developer-reference#filteradd">“filteradd” message</a> adding a TXID. (The message header has been omitted.) This TXID appears in the same block used for the example hexdump in the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a>; if that <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> is re-sent after sending this <a class="reference external" href="/en/developer-reference#filteradd">“filteradd” message</a>, six hashes are returned instead of four.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>20 ................................. Element bytes: 32
fdacf9b3eb077412e7a968d2e4f11b9a
9dee312d666187ed77ee7d26af16cb0b ... Element (A TXID)
</pre></div>
</div>
</div>
<div class="section" id="filterclear">
<h3>FilterClear<a class="headerlink" href="#filterclear" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70001</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#filterclear">“filterclear” message</a> tells the receiving peer to remove a previously-set bloom filter. This also undoes the effect of setting the relay field in the <a class="reference external" href="/en/developer-reference#version">“version” message</a> to 0, allowing unfiltered access to <a class="reference external" href="/en/developer-reference#inv">“inv” messages</a> announcing new transactions.</p>
<p>Bitcoin Core does not require a <a class="reference external" href="/en/developer-reference#filterclear">“filterclear” message</a> before a replacement filter is loaded with <code class="docutils literal notranslate"><span class="pre">filterload</span></code>. It also doesn’t require a <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a> before a <a class="reference external" href="/en/developer-reference#filterclear">“filterclear” message</a>.</p>
<p>There is no payload in a <a class="reference external" href="/en/developer-reference#filterclear">“filterclear” message</a>. See the <a class="reference external" href="/en/developer-reference#message-headers">message header section</a> for an example of a message without a payload.</p>
</div>
<div class="section" id="filterload">
<h3>FilterLoad<a class="headerlink" href="#filterload" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70001</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a> tells the receiving peer to filter all relayed transactions and requested merkle blocks through the provided filter. This allows clients to receive transactions relevant to their wallet plus a configurable rate of false positive transactions which can provide plausible-deniability privacy.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 5%" />
<col style="width: 7%" />
<col style="width: 8%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>nFilterBytes</p></td>
<td><p>compactSize uint</p></td>
<td><p>Number of bytes in the following filter bit field.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>filter</p></td>
<td><p>uint8_t[]</p></td>
<td><p>A bit field of arbitrary byte-aligned size. The maximum size is 36,000 bytes.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>nHashFuncs</p></td>
<td><p>uint32_t</p></td>
<td><p>The number of hash functions to use in this filter. The maximum value allowed in this field is 50.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>nTweak</p></td>
<td><p>uint32_t</p></td>
<td><p>An arbitrary value to add to the seed value in the hash function used by the bloom filter.</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>nFlags</p></td>
<td><p>uint8_t</p></td>
<td><p>A set of flags that control how outpoints corresponding to a matched pubkey script are added to the filter. See the table in the Updating A Bloom Filter subsection below.</p></td>
</tr>
</tbody>
</table>
<p>The annotated hexdump below shows a <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a>. (The message header has been omitted.) For an example of how this payload was created, see the <a class="reference external" href="/en/developer-examples#creating-a-bloom-filter">filterload example</a>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>02 ......... Filter bytes: 2
b50f ....... Filter: 1010 1101 1111 0000
0b000000 ... nHashFuncs: 11
00000000 ... nTweak: 0/none
00 ......... nFlags: BLOOM_UPDATE_NONE
</pre></div>
</div>
<p><strong>Initializing A Bloom Filter</strong></p>
<p>Filters have two core parameters: the size of the bit field and the number of hash functions to run against each data element. The following formulas from <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a> will allow you to automatically select appropriate values based on the number of elements you plan to insert into the filter (<em>n</em>) and the false positive rate (<em>p</em>) you desire to maintain plausible deniability.</p>
<ul class="simple">
<li><p>Size of the bit field in bytes (<em>nFilterBytes</em>), up to a maximum of 36,000: <code class="docutils literal notranslate"><span class="pre">(-1</span> <span class="pre">/</span> <span class="pre">log(2)**2</span> <span class="pre">*</span> <span class="pre">n</span> <span class="pre">*</span> <span class="pre">log(p))</span> <span class="pre">/</span> <span class="pre">8</span></code></p></li>
<li><p>Hash functions to use (<em>nHashFuncs</em>), up to a maximum of 50: <code class="docutils literal notranslate"><span class="pre">nFilterBytes</span> <span class="pre">*</span> <span class="pre">8</span> <span class="pre">/</span> <span class="pre">n</span> <span class="pre">*</span> <span class="pre">log(2)</span></code></p></li>
</ul>
<p>Note that the filter matches parts of transactions (transaction elements), so the false positive rate is relative to the number of elements checked—not the number of transactions checked. Each normal transaction has a minimum of four matchable elements (described in the comparison subsection below), so a filter with a false-positive rate of 1 percent will match about 4 percent of all transactions at a minimum.</p>
<p>According to <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a>, the formulas and limits described above provide support for bloom filters containing 20,000 items with a false positive rate of less than 0.1 percent or 10,000 items with a false positive rate of less than 0.0001 percent.</p>
<p>Once the size of the bit field is known, the bit field should be initialized as all zeroes.</p>
<p><strong>Populating A Bloom Filter</strong></p>
<p>The bloom filter is populated using between 1 and 50 unique hash functions (the number specified per filter by the <em>nHashFuncs</em> field). Instead of using up to 50 different hash function implementations, a single implementation is used with a unique seed value for each function.</p>
<p>The seed is <code class="docutils literal notranslate"><span class="pre">nHashNum</span> <span class="pre">*</span> <span class="pre">0xfba4c795</span> <span class="pre">+</span> <span class="pre">nTweak</span></code> as a <em>uint32_t</em>, where the values are:</p>
<ul class="simple">
<li><p><strong>nHashNum</strong> is the sequence number for this hash function, starting at 0 for the first hash iteration and increasing up to the value of the <em>nHashFuncs</em> field (minus one) for the last hash iteration.</p></li>
<li><p><strong>0xfba4c795</strong> is a constant optimized to create large differences in the seed for different values of <em>nHashNum</em>.</p></li>
<li><p><strong>nTweak</strong> is a per-filter constant set by the client to require the use of an arbitrary set of hash functions.</p></li>
</ul>
<p>If the seed resulting from the formula above is larger than four bytes, it must be truncated to its four most significant bytes (for example, <code class="docutils literal notranslate"><span class="pre">0x8967452301</span> <span class="pre">&amp;</span> <span class="pre">0xffffffff</span> <span class="pre">→</span> <span class="pre">0x67452301</span></code>).</p>
<p>The actual hash function implementation used is the <a class="reference external" href="https://en.wikipedia.org/wiki/MurmurHash">32-bit Murmur3 hash function</a>.</p>
<p><img alt="Warning icon" src="../_images/icon_warning.svg" /> <strong>Warning:</strong> the Murmur3 hash function has separate 32-bit and 64-bit versions that produce different results for the same input. Only the 32-bit Murmur3 version is used with Bitcoin bloom filters.</p>
<p>The data to be hashed can be any transaction element which the bloom filter can match. See the next subsection for the list of transaction elements checked against the filter. The largest element which can be matched is a script data push of 520 bytes, so the data should never exceed 520 bytes.</p>
<p>The example below from Bitcoin Core <a class="reference external" href="https://github.com/bitcoin/bitcoin/blob/cbf28c6619fe348a258dfd7d08bdbd2392d07511/src/bloom.cpp#L46">bloom.cpp</a> combines all the steps above to create the hash function template. The seed is the first parameter; the data to be hashed is the second parameter. The result is a uint32_t modulo the size of the bit field in bits.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">MurmurHash3</span><span class="p">(</span><span class="n">nHashNum</span> <span class="o">*</span> <span class="mh">0xFBA4C795</span> <span class="o">+</span> <span class="n">nTweak</span><span class="p">,</span> <span class="n">vDataToHash</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">vData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>Each data element to be added to the filter is hashed by <em>nHashFuncs</em> number of hash functions. Each time a hash function is run, the result will be the index number (<em>nIndex</em>) of a bit in the bit field. That bit must be set to 1. For example if the filter bit field was <code class="docutils literal notranslate"><span class="pre">00000000</span></code> and the result is 5, the revised filter bit field is <code class="docutils literal notranslate"><span class="pre">00000100</span></code> (the first bit is bit 0).</p>
<p>It is expected that sometimes the same index number will be returned more than once when populating the bit field; this does not affect the algorithm—after a bit is set to 1, it is never changed back to 0.</p>
<p>After all data elements have been added to the filter, each set of eight bits is converted into a little-endian byte. These bytes are the value of the <em>filter</em> field.</p>
<p><strong>Comparing Transaction Elements To A Bloom Filter</strong></p>
<p>To compare an arbitrary data element against the bloom filter, it is hashed using the same parameters used to create the bloom filter. Specifically, it is hashed <em>nHashFuncs</em> times, each time using the same <em>nTweak</em> provided in the filter, and the resulting output is modulo the size of the bit field provided in the <em>filter</em> field. After each hash is performed, the filter is checked to see if the bit at that indexed location is set. For example if the result of a hash is <code class="docutils literal notranslate"><span class="pre">5</span></code> and the filter is <code class="docutils literal notranslate"><span class="pre">01001110</span></code>, the bit is considered set.</p>
<p>If the result of every hash points to a set bit, the filter matches. If any of the results points to an unset bit, the filter does not match.</p>
<p>The following transaction elements are compared against bloom filters. All elements will be hashed in the byte order used in blocks (for example, TXIDs will be in internal byte order).</p>
<ul class="simple">
<li><p><strong>TXIDs:</strong> the transaction’s SHA256(SHA256()) hash.</p></li>
<li><p><strong>Outpoints:</strong> each 36-byte outpoint used this transaction’s input section is individually compared to the filter.</p></li>
<li><p><strong>Signature Script Data:</strong> each element pushed onto the stack by a data-pushing opcode in a signature script from this transaction is individually compared to the filter. This includes data elements present in P2SH redeem scripts when they are being spent.</p></li>
<li><p><strong>PubKey Script Data:</strong> each element pushed onto the the stack by a data-pushing opcode in any pubkey script from this transaction is individually compared to the filter. (If a pubkey script element matches the filter, the filter will be immediately updated if the <code class="docutils literal notranslate"><span class="pre">BLOOM_UPDATE_ALL</span></code> flag was set; if the pubkey script is in the P2PKH format and matches the filter, the filter will be immediately updated if the <code class="docutils literal notranslate"><span class="pre">BLOOM_UPDATE_P2PUBKEY_ONLY</span></code> flag was set. See the subsection below for details.)</p></li>
</ul>
<p>The following annotated hexdump of a transaction is from the <a class="reference external" href="/en/developer-reference#raw-transaction-format">raw transaction format section</a>; the elements which would be checked by the filter are emphasized in bold. Note that this transaction’s TXID (<strong>``01000000017b1eab[…]``</strong>) would also be checked, and that the outpoint TXID and index number below would be checked as a single 36-byte element.</p>
<pre><code>01000000 ................................... Version

01 ......................................... Number of inputs
|
| <b>7b1eabe0209b1fe794124575ef807057</b>
| <b>c77ada2138ae4fa8d6c4de0398a14f3f</b> ......... Outpoint TXID
| <b>00000000</b> ................................. Outpoint index number
|
| 49 ....................................... Bytes in sig. script: 73
| | 48 ..................................... Push 72 bytes as data
| | | <b>30450221008949f0cb400094ad2b5eb3</b>
| | | <b>99d59d01c14d73d8fe6e96df1a7150de</b>
| | | <b>b388ab8935022079656090d7f6bac4c9</b>
| | | <b>a94e0aad311a4268e082a725f8aeae05</b>
| | | <b>73fb12ff866a5f01</b> ..................... Secp256k1 signature
|
| ffffffff ................................. Sequence number: UINT32_MAX

01 ......................................... Number of outputs
| f0ca052a01000000 ......................... Satoshis (49.99990000 BTC)
|
| 19 ....................................... Bytes in pubkey script: 25
| | 76 ..................................... OP_DUP
| | a9 ..................................... OP_HASH160
| | 14 ..................................... Push 20 bytes as data
| | | <b>cbc20a7664f2f69e5355aa427045bc15</b>
| | | <b>e7c6c772</b> ............................. PubKey hash
| | 88 ..................................... OP_EQUALVERIFY
| | ac ..................................... OP_CHECKSIG

00000000 ................................... locktime: 0 (a block height)
</code></pre><p><strong>Updating A Bloom Filter</strong></p>
<p>Clients will often want to track inputs that spend outputs (outpoints) relevant to their wallet, so the filterload field <em>nFlags</em> can be set to allow the filtering node to update the filter when a match is found. When the filtering node sees a pubkey script that pays a pubkey, address, or other data element matching the filter, the filtering node immediately updates the filter with the outpoint corresponding to that pubkey script.</p>
<div class="figure align-center" id="id5">
<img alt="Automatically Updating Bloom Filters" src="../_images/en-bloom-update.svg" /><p class="caption"><span class="caption-text">Automatically Updating Bloom Filters</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>If an input later spends that outpoint, the filter will match it, allowing the filtering node to tell the client that one of its transaction outputs has been spent.</p>
<p>The <em>nFlags</em> field has three allowed values:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 3%" />
<col style="width: 13%" />
<col style="width: 84%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>BLOOM_UPDATE_NONE</p></td>
<td><p>The filtering node should not update the filter.</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>BLOOM_UPDATE_ALL</p></td>
<td><p>If the filter matches any data element in a pubkey script, the corresponding outpoint is added to the filter.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>BLOOM_UPDATE_P2PUBKEY_ONLY</p></td>
<td><p>If the filter matches any data element in a pubkey script and that script is either a P2PKH or non-P2SH pay-to-multisig script, the corresponding outpoint is added to the filter.</p></td>
</tr>
</tbody>
</table>
<p>In addition, because the filter size stays the same even though additional elements are being added to it, the false positive rate increases. Each false positive can result in another element being added to the filter, creating a feedback loop that can (after a certain point) make the filter useless. For this reason, clients using automatic filter updates need to monitor the actual false positive rate and send a new filter when the rate gets too high.</p>
</div>
<div class="section" id="getaddr">
<h3>GetAddr<a class="headerlink" href="#getaddr" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#getaddr">“getaddr” message</a> requests an <a class="reference external" href="/en/developer-reference#addr">“addr” message</a> from the receiving node, preferably one with lots of IP addresses of other receiving nodes. The transmitting node can use those IP addresses to quickly update its database of available nodes rather than waiting for unsolicited <a class="reference external" href="/en/developer-reference#addr">“addr” messages</a> to arrive over time.</p>
<p>There is no payload in a <a class="reference external" href="/en/developer-reference#getaddr">“getaddr” message</a>. See the <a class="reference external" href="/en/developer-reference#message-headers">message header section</a> for an example of a message without a payload.</p>
</div>
<div class="section" id="ping">
<h3>Ping<a class="headerlink" href="#ping" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#ping">“ping” message</a> helps confirm that the receiving peer is still connected. If a TCP/IP error is encountered when sending the <a class="reference external" href="/en/developer-reference#ping">“ping” message</a> (such as a connection timeout), the transmitting node can assume that the receiving node is disconnected. The response to a <a class="reference external" href="/en/developer-reference#ping">“ping” message</a> is the <a class="reference external" href="/en/developer-reference#pong">“pong” message</a>.</p>
<p>Before <a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 60000</a>, the <a class="reference external" href="/en/developer-reference#ping">“ping” message</a> had no payload. As of <a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 60001</a> and all later versions, the message includes a single field, the nonce.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 1%" />
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 95%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8</p></td>
<td><p>nonce</p></td>
<td><p>uint64_t</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 60001</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki">BIP31</a><em>.</em> Random nonce assigned to this <a class="reference external" href="/en/developer-reference#ping">“ping” message</a>. The responding <a class="reference external" href="/en/developer-reference#pong">“pong” message</a> will include this nonce to identify the <a class="reference external" href="/en/developer-reference#ping">“ping” message</a> to which it is replying.</p></td>
</tr>
</tbody>
</table>
<p>The annotated hexdump below shows a <a class="reference external" href="/en/developer-reference#ping">“ping” message</a>. (The message header has been omitted.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0094102111e2af4d ... Nonce
</pre></div>
</div>
</div>
<div class="section" id="pong">
<h3>Pong<a class="headerlink" href="#pong" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 60001</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0031.mediawiki">BIP31</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#pong">“pong” message</a> replies to a <a class="reference external" href="/en/developer-reference#ping">“ping” message</a>, proving to the pinging node that the ponging node is still alive. Bitcoin Core will, by default, disconnect from any clients which have not responded to a <a class="reference external" href="/en/developer-reference#ping">“ping” message</a> within 20 minutes.</p>
<p>To allow nodes to keep track of latency, the <a class="reference external" href="/en/developer-reference#pong">“pong” message</a> sends back the same nonce received in the <a class="reference external" href="/en/developer-reference#ping">“ping” message</a> it is replying to.</p>
<p>The format of the <a class="reference external" href="/en/developer-reference#pong">“pong” message</a> is identical to the <a class="reference external" href="/en/developer-reference#ping">“ping” message</a>; only the message header differs.</p>
</div>
<div class="section" id="reject">
<h3>Reject<a class="headerlink" href="#reject" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70002</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki">BIP61</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#reject">“reject” message</a> informs the receiving node that one of its previous messages has been rejected.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 3%" />
<col style="width: 5%" />
<col style="width: 6%" />
<col style="width: 87%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>message bytes</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of bytes in the following message field.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>message</p></td>
<td><p>string</p></td>
<td><p>The type of message rejected as ASCII text <em>without null padding</em>. For example: “tx”, “block”, or “version”.</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>code</p></td>
<td><p>char</p></td>
<td><p>The reject message code. See the table below.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>reason bytes</p></td>
<td><p>compactSize uint</p></td>
<td><p>The number of bytes in the following reason field. May be 0x00 if a text reason isn’t provided.</p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>reason</p></td>
<td><p>string</p></td>
<td><p>The reason for the rejection in ASCII text. This should not be displayed to the user; it is only for debugging purposes.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>extra data</p></td>
<td><p><em>varies</em></p></td>
<td><p>Optional additional data provided with the rejection. For example, most rejections of <a class="reference external" href="/en/developer-reference#tx">“tx” messages</a> or <a class="reference external" href="/en/developer-reference#block">“block” messages</a> include the hash of the rejected transaction or block header. See the code table below.</p></td>
</tr>
</tbody>
</table>
<p>The following table lists message reject codes. Codes are tied to the type of message they reply to; for example there is a 0x10 reject code for transactions and a 0x10 reject code for blocks.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 2%" />
<col style="width: 16%" />
<col style="width: 4%" />
<col style="width: 3%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Code</p></th>
<th class="head"><p>In Reply To</p></th>
<th class="head"><p>Extra Bytes</p></th>
<th class="head"><p>Extra Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x01</p></td>
<td><p><em>any message</em></p></td>
<td><p>0</p></td>
<td><p>N/A</p></td>
<td><p>Message could not be decoded. Be careful of <a class="reference external" href="/en/developer-reference#reject">“reject” message</a> feedback loops where two peers each don’t understand each other’s <a class="reference external" href="/en/developer-reference#reject">“reject” messages</a> and so keep sending them back and forth forever.</p></td>
</tr>
<tr class="row-odd"><td><p>0x10</p></td>
<td><p><a class="reference external" href="/en/developer-reference#block">“block” message</a></p></td>
<td><p>32</p></td>
<td><p>char[32]</p></td>
<td><p>Block is invalid for some reason (invalid proof-of-work, invalid signature, etc). Extra data may include the rejected block’s header hash.</p></td>
</tr>
<tr class="row-even"><td><p>0x10</p></td>
<td><p><a class="reference external" href="/en/developer-reference#tx">“tx” message</a></p></td>
<td><p>32</p></td>
<td><p>char[32]</p></td>
<td><p>Transaction is invalid for some reason (invalid signature, output value greater than input, etc.). Extra data may include the rejected transaction’s TXID.</p></td>
</tr>
<tr class="row-odd"><td><p>0x11</p></td>
<td><p><a class="reference external" href="/en/developer-reference#block">“block” message</a></p></td>
<td><p>32</p></td>
<td><p>char[32]</p></td>
<td><p>The block uses a version that is no longer supported. Extra data may include the rejected block’s header hash.</p></td>
</tr>
<tr class="row-even"><td><p>0x11</p></td>
<td><p><a class="reference external" href="/en/developer-reference#version">“version” message</a></p></td>
<td><p>0</p></td>
<td><p>N/A</p></td>
<td><p>Connecting node is using a protocol version that the rejecting node considers obsolete and unsupported.</p></td>
</tr>
<tr class="row-odd"><td><p>0x12</p></td>
<td><p><a class="reference external" href="/en/developer-reference#tx">“tx” message</a></p></td>
<td><p>32</p></td>
<td><p>char[32]</p></td>
<td><p>Duplicate input spend (double spend): the rejected transaction spends the same input as a previously-received transaction. Extra data may include the rejected transaction’s TXID.</p></td>
</tr>
<tr class="row-even"><td><p>0x12</p></td>
<td><p><a class="reference external" href="/en/developer-reference#version">“version” message</a></p></td>
<td><p>0</p></td>
<td><p>N/A</p></td>
<td><p>More than one <a class="reference external" href="/en/developer-reference#version">“version” message</a> received in this connection.</p></td>
</tr>
<tr class="row-odd"><td><p>0x40</p></td>
<td><p><a class="reference external" href="/en/developer-reference#tx">“tx” message</a></p></td>
<td><p>32</p></td>
<td><p>char[32]</p></td>
<td><p>The transaction will not be mined or relayed because the rejecting node considers it non-standard—a transaction type or version unknown by the server. Extra data may include the rejected transaction’s TXID.</p></td>
</tr>
<tr class="row-even"><td><p>0x41</p></td>
<td><p><a class="reference external" href="/en/developer-reference#tx">“tx” message</a></p></td>
<td><p>32</p></td>
<td><p>char[32]</p></td>
<td><p>One or more output amounts are below the dust threshold. Extra data may include the rejected transaction’s TXID.</p></td>
</tr>
<tr class="row-odd"><td><p>0x42</p></td>
<td><p><a class="reference external" href="/en/developer-reference#tx">“tx” message</a></p></td>
<td></td>
<td><p>char[32]</p></td>
<td><p>The transaction did not have a large enough fee or priority to be relayed or mined. Extra data may include the rejected transaction’s TXID.</p></td>
</tr>
<tr class="row-even"><td><p>0x43</p></td>
<td><p><a class="reference external" href="/en/developer-reference#block">“block” message</a></p></td>
<td><p>32</p></td>
<td><p>char[32]</p></td>
<td><p>The block belongs to a block chain which is not the same block chain as provided by a compiled-in checkpoint. Extra data may include the rejected block’s header hash.</p></td>
</tr>
</tbody>
</table>
<p>The annotated hexdump below shows a <a class="reference external" href="/en/developer-reference#reject">“reject” message</a>. (The message header has been omitted.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>02 ................................. Number of bytes in message: 2
7478 ............................... Type of message rejected: tx
12 ................................. Reject code: 0x12 (duplicate)
15 ................................. Number of bytes in reason: 21
6261642d74786e732d696e707574732d
7370656e74 ......................... Reason: bad-txns-inputs-spent
394715fcab51093be7bfca5a31005972
947baf86a31017939575fb2354222821 ... TXID
</pre></div>
</div>
</div>
<div class="section" id="sendheaders">
<h3>SendHeaders<a class="headerlink" href="#sendheaders" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#sendheaders">“sendheaders” message</a> tells the receiving peer to send new block announcements using a <a class="reference external" href="/en/developer-reference#headers">“headers” message</a> rather than an <a class="reference external" href="/en/developer-reference#inv">“inv” message</a>.</p>
<p>There is no payload in a <a class="reference external" href="/en/developer-reference#sendheaders">“sendheaders” message</a>. See the <a class="reference external" href="/en/developer-reference#message-headers">message header section</a> for an example of a message without a payload.</p>
</div>
<div class="section" id="verack">
<h3>VerAck<a class="headerlink" href="#verack" title="Permalink to this headline">¶</a></h3>
<p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 209</a><em>.</em></p>
<p>The <a class="reference external" href="/en/developer-reference#verack">“verack” message</a> acknowledges a previously-received <a class="reference external" href="/en/developer-reference#version">“version” message</a>, informing the connecting node that it can begin to send other messages. The <a class="reference external" href="/en/developer-reference#verack">“verack” message</a> has no payload; for an example of a message with no payload, see the <a class="reference external" href="/en/developer-reference#message-headers">message headers section</a>.</p>
</div>
<div class="section" id="version">
<h3>Version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="/en/developer-reference#version">“version” message</a> provides information about the transmitting node to the receiving node at the beginning of a connection. Until both peers have exchanged <a class="reference external" href="/en/developer-reference#version">“version” messages</a>, no other messages will be accepted.</p>
<p>If a <a class="reference external" href="/en/developer-reference#version">“version” message</a> is accepted, the receiving node should send a <a class="reference external" href="/en/developer-reference#verack">“verack” message</a>—but no node should send a <a class="reference external" href="/en/developer-reference#verack">“verack” message</a> before initializing its half of the connection by first sending a <a class="reference external" href="/en/developer-reference#version">“version” message</a>.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 1%" />
<col style="width: 3%" />
<col style="width: 2%" />
<col style="width: 4%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Required/Optional</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4</p></td>
<td><p>version</p></td>
<td><p>int32_t</p></td>
<td><p>Required</p></td>
<td><p>The highest protocol version understood by the transmitting node. See the <a class="reference external" href="/en/developer-reference#protocol-versions">protocol version section</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>services</p></td>
<td><p>uint64_t</p></td>
<td><p>Required</p></td>
<td><p>The services supported by the transmitting node encoded as a bitfield. See the list of service codes below.</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>timestamp</p></td>
<td><p>int64_t</p></td>
<td><p>Required</p></td>
<td><p>The current <a class="reference external" href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch time</a> according to the transmitting node’s clock. Because nodes will reject blocks with timestamps more than two hours in the future, this field can help other nodes to determine that their clock is wrong.</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>addr_recv services</p></td>
<td><p>uint64_t</p></td>
<td><p>Required</p></td>
<td><p>The services supported by the receiving node as perceived by the transmitting node. Same format as the ‘services’ field above. Bitcoin Core will attempt to provide accurate information. <a class="reference external" href="http://bitcoinj.github.io">BitcoinJ</a> will, by default, always send 0.</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>addr_recv IP address</p></td>
<td><p>char</p></td>
<td><p>Required</p></td>
<td><p>The IPv6 address of the receiving node as perceived by the transmitting node in <strong>big endian byte order</strong>. IPv4 addresses can be provided as <a class="reference external" href="http://en.wikipedia.org/wiki/IPv6#IPv4-mapped_IPv6_addresses">IPv4-mapped IPv6 addresses</a>. Bitcoin Core will attempt to provide accurate information. <a class="reference external" href="http://bitcoinj.github.io">BitcoinJ</a> will, by default, always return ::ffff:127.0.0.1</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>addr_recv port</p></td>
<td><p>uint16_t</p></td>
<td><p>Required</p></td>
<td><p>The port number of the receiving node as perceived by the transmitting node in <strong>big endian byte order</strong>.</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>addr_trans services</p></td>
<td><p>uint64_t</p></td>
<td><p>Required</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 106</a><em>.</em> The services supported by the transmitting node. Should be identical to the ‘services’ field above.</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p>addr_trans IP address</p></td>
<td><p>char</p></td>
<td><p>Required</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 106</a><em>.</em> The IPv6 address of the transmitting node in <strong>big endian byte order</strong>. IPv4 addresses can be provided as <a class="reference external" href="http://en.wikipedia.org/wiki/IPv6#IPv4-mapped_IPv6_addresses">IPv4-mapped IPv6 addresses</a>. Set to ::ffff:127.0.0.1 if unknown.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>addr_trans port</p></td>
<td><p>uint16_t</p></td>
<td><p>Required</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 106</a><em>.</em> The port number of the transmitting node in <strong>big endian byte order</strong>.</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>nonce</p></td>
<td><p>uint64_t</p></td>
<td><p>Required</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 106</a><em>.</em> A random nonce which can help a node detect a connection to itself. If the nonce is 0, the nonce field is ignored. If the nonce is anything else, a node should terminate the connection on receipt of a <a class="reference external" href="/en/developer-reference#version">“version” message</a> with a nonce it previously sent.</p></td>
</tr>
<tr class="row-even"><td><p><em>Varies</em></p></td>
<td><p>user_agent bytes</p></td>
<td><p>compactSize uint</p></td>
<td><p>Required</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 106</a><em>.</em> Number of bytes in following user_agent field. If 0x00, no user agent field is sent.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Varies</em></p></td>
<td><p>user_agent</p></td>
<td><p>string</p></td>
<td><p>Required if user_agent bytes &gt; 0</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 106</a><em>. Renamed in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 60000</a><em>.</em> User agent as defined by <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0014.mediawiki">BIP14</a>. Previously called subVer.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>start_height</p></td>
<td><p>int32_t</p></td>
<td><p>Required</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 209</a><em>.</em> The height of the transmitting node’s best block chain or, in the case of an SPV client, best block header chain.</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>relay</p></td>
<td><p>bool</p></td>
<td><p>Optional</p></td>
<td><p><em>Added in</em><a class="reference external" href="/en/developer-reference#protocol-versions">protocol version 70001</a><em>as described by</em><a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a><em>.</em> Transaction relay flag. If 0x00, no <a class="reference external" href="/en/developer-reference#inv">“inv” messages</a> or <a class="reference external" href="/en/developer-reference#tx">“tx” messages</a> announcing new transactions should be sent to this client until it sends a <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a> or <a class="reference external" href="/en/developer-reference#filterclear">“filterclear” message</a>. If the relay field is not present or is set to 0x01, this node wants <a class="reference external" href="/en/developer-reference#inv">“inv” messages</a> and <a class="reference external" href="/en/developer-reference#tx">“tx” messages</a> announcing new transactions.</p></td>
</tr>
</tbody>
</table>
<p>The following service identifiers have been assigned.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 4%" />
<col style="width: 8%" />
<col style="width: 87%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x00</p></td>
<td><p><em>Unnamed</em></p></td>
<td><p>This node is not a full node. It may not be able to provide any data except for the transactions it originates.</p></td>
</tr>
<tr class="row-odd"><td><p>0x01</p></td>
<td><p>NODE_NETWORK</p></td>
<td><p>This is a full node and can be asked for full blocks. It should implement all protocol features available in its self-reported protocol version.</p></td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows a <a class="reference external" href="/en/developer-reference#version">“version” message</a>. (The message header has been omitted and the actual IP addresses have been replaced with <a class="reference external" href="http://tools.ietf.org/html/rfc5737">RFC5737</a> reserved IP addresses.)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>72110100 ........................... Protocol version: 70002
0100000000000000 ................... Services: NODE_NETWORK
bc8f5e5400000000 ................... [Epoch time][unix epoch time]: 1415483324

0100000000000000 ................... Receiving node&#39;s services
00000000000000000000ffffc61b6409 ... Receiving node&#39;s IPv6 address
208d ............................... Receiving node&#39;s port number

0100000000000000 ................... Transmitting node&#39;s services
00000000000000000000ffffcb0071c0 ... Transmitting node&#39;s IPv6 address
208d ............................... Transmitting node&#39;s port number

128035cbc97953f8 ................... Nonce

0f ................................. Bytes in user agent string: 15
2f5361746f7368693a302e392e332f ..... User agent: /Satoshi:0.9.3/

cf050500 ........................... Start height: 329167
01 ................................. Relay flag: true
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    </div>
      <div class="clearer"></div>
      </div>
    </div>
<footer class="footer d-flex justify-content-between flex-wrap">
    <div class="copyright">
        <div>&copy; Copyright 2019 Bitcoin Developer Documentation.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.0.1 using <a href="https://github.com/myyasuda/sphinxbootstrap4theme">sphinxbootstrap4theme</a> 0.6.0.</div>
    </div>
    <div>
        <a href="#" class="btn btn-primary btn-sm" role="botton">Back to top</a>
    </div>
</footer>
  </body>
</html>